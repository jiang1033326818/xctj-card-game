<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å–œä»å¤©é™æ¸¸æˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px;
            margin: 0;
            height: 100vh;
            overflow: hidden;
        }
        .container {
            max-width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            margin: 0 auto;
            padding: 0 20px;
        }
        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: rgba(255,255,255,0.2);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .nav-btn:hover { background: rgba(255,255,255,0.3); }
        .nav-btn.active { background: #4CAF50; }
        .interface { display: none; }
        .interface.active { display: block; }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            font-size: 20px;
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 10px;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            gap: 20px;
            min-height: 0;
        }
        
        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .center-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .card-display {
            width: 180px;
            height: 250px;
            margin: 0 auto 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            background: white;
            color: #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.5s ease;
            position: relative;
        }
        
        .card-display.flipping {
            transform: rotateY(180deg);
        }
        
        .card-back {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            font-size: 24px;
            font-weight: bold;
        }
        
        .suit-hearts { color: #e74c3c; }
        .suit-diamonds { color: #e74c3c; }
        .suit-clubs { color: #2c3e50; }
        .suit-spades { color: #2c3e50; }
        .suit-joker { 
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }
        
        .controls {
            text-align: center;
            margin: 30px 0;
        }
        .btn {
            padding: 12px 25px;
            margin: 0 10px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn-primary { 
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }
        .btn-secondary { 
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: white;
        }
        .btn-danger { 
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .panel-section {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            min-height: 0;
            overflow-y: auto;
        }
        
        .panel-section h3 {
            margin: 0 0 15px 0;
            font-size: 16px;
        }
        
        .chips-section {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
        }
        
        .chips {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        .chip {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid white;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.3s;
        }
        .chip:hover { transform: scale(1.1); }
        .chip.selected { 
            box-shadow: 0 0 20px #FFD700;
            border-color: #FFD700;
        }
        .chip[data-value="1"] { background: linear-gradient(45deg, #fff, #f8f9fa); color: #333; }
        .chip[data-value="5"] { background: linear-gradient(45deg, #dc3545, #c82333); color: white; }
        .chip[data-value="10"] { background: linear-gradient(45deg, #007bff, #0056b3); color: white; }
        .chip[data-value="25"] { background: linear-gradient(45deg, #28a745, #1e7e34); color: white; }
        .chip[data-value="100"] { background: linear-gradient(45deg, #6f42c1, #5a32a3); color: white; }
        
        .suits-section {
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
        }
        
        .suits-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .suit-btn {
            height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: all 0.3s;
            position: relative;
        }
        .suit-btn:hover { 
            background: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }
        .suit-btn .suit-icon {
            font-size: 20px;
            margin-bottom: 3px;
        }
        .suit-btn[data-suit="hearts"] { color: #e74c3c; }
        .suit-btn[data-suit="diamonds"] { color: #e74c3c; }
        .suit-btn[data-suit="clubs"] { color: #2c3e50; }
        .suit-btn[data-suit="spades"] { color: #2c3e50; }
        .suit-btn[data-suit="joker"] { 
            color: #f39c12;
            grid-column: span 2;
        }
        
        .bet-amount {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #FFD700;
            color: #333;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .current-bets {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }
        
        .result {
            text-align: center;
            padding: 25px;
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .result.hidden { display: none; }
        .result-suit {
            font-size: 60px;
            margin-bottom: 15px;
        }
        .result-text {
            font-size: 24px;
            font-weight: bold;
        }
        
        .history {
            margin-top: 30px;
            background: rgba(0,0,0,0.2);
            padding: 20px;
            border-radius: 10px;
        }
        .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .history-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            background: rgba(255,255,255,0.1);
        }
        
        .password-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .password-modal.hidden { display: none; }
        .password-box {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .password-input {
            padding: 10px 15px;
            margin: 15px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            text-align: center;
            background: rgba(255,255,255,0.9);
            color: #333;
            width: 200px;
        }
        .password-input:focus {
            outline: none;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        .stats-container {
            background: rgba(0,0,0,0.3);
            padding: 30px;
            border-radius: 15px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 10px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <button id="playerView" class="nav-btn active">ç©å®¶ç•Œé¢</button>
            <button id="houseView" class="nav-btn">åº„å®¶ç»Ÿè®¡</button>
        </nav>
        
        <!-- å¯†ç è¾“å…¥æ¨¡æ€æ¡† -->
        <div id="passwordModal" class="password-modal hidden">
            <div class="password-box">
                <h3>ğŸ” åº„å®¶ç»Ÿè®¡è®¿é—®</h3>
                <p>è¯·è¾“å…¥å¯†ç è®¿é—®åº„å®¶ç»Ÿè®¡é¡µé¢</p>
                <input type="password" id="passwordInput" class="password-input" placeholder="è¯·è¾“å…¥å¯†ç " maxlength="10">
                <br>
                <button id="passwordSubmit" class="btn btn-primary">ç¡®è®¤</button>
                <button id="passwordCancel" class="btn btn-secondary">å–æ¶ˆ</button>
                <div id="passwordError" style="color: #ff6b6b; margin-top: 10px; display: none;">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</div>
            </div>
        </div>
        
        <div id="playerInterface" class="interface active">
            <h1 style="text-align: center; margin: 0 0 15px 0; font-size: 28px;">ğŸ° å–œä»å¤©é™ ğŸ°</h1>
            
            <div class="game-info">
                <div>ğŸ’° ä½™é¢: $<span id="balance">1000</span></div>
                <div>ğŸ® çŠ¶æ€: <span id="status">ç­‰å¾…ä¸‹æ³¨</span></div>
            </div>
            
            <div class="main-content">
                <div class="left-panel">
                    <div class="panel-section chips-section">
                        <h3>ğŸ’ é€‰æ‹©ç­¹ç </h3>
                        <div class="chips">
                            <div class="chip selected" data-value="1">$1</div>
                            <div class="chip" data-value="5">$5</div>
                            <div class="chip" data-value="10">$10</div>
                            <div class="chip" data-value="25">$25</div>
                            <div class="chip" data-value="100">$100</div>
                        </div>
                        
                        <div class="current-bets">
                            <h4 style="margin: 15px 0 10px 0; font-size: 14px;">å½“å‰æŠ¼æ³¨</h4>
                            <div id="betsList"></div>
                            <div style="margin-top: 10px; font-size: 16px; font-weight: bold;">
                                æ€»æŠ¼æ³¨: $<span id="totalBet">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="panel-section">
                        <h3>ğŸ“Š å†å²è®°å½•</h3>
                        <div id="historyList" class="history-list"></div>
                    </div>
                </div>
                
                <div class="center-panel">
                    <div id="cardDisplay" class="card-display card-back">
                        ğŸ´<br>å–œä»å¤©é™
                    </div>
                    
                    <div class="controls">
                        <button id="drawBtn" class="btn btn-primary">ğŸ¯ å¼€å§‹æŠ½ç‰Œ</button>
                        <button id="clearBtn" class="btn btn-secondary">ğŸ—‘ï¸ æ¸…é™¤æŠ¼æ³¨</button>
                    </div>
                    
                    <div id="result" class="result hidden">
                        <div class="result-suit" id="resultSuit"></div>
                        <div class="result-text" id="resultText"></div>
                    </div>
                </div>
                
                <div class="right-panel">
                    <div class="panel-section suits-section">
                        <h3>ğŸƒ é€‰æ‹©èŠ±è‰²</h3>
                        <div class="suits-grid">
                            <div class="suit-btn" data-suit="hearts">
                                <div class="suit-icon">â™¥ï¸</div>
                                <div>çº¢æ¡ƒ (1:3.5)</div>
                            </div>
                            <div class="suit-btn" data-suit="diamonds">
                                <div class="suit-icon">â™¦ï¸</div>
                                <div>æ–¹ç‰‡ (1:3.5)</div>
                            </div>
                            <div class="suit-btn" data-suit="clubs">
                                <div class="suit-icon">â™£ï¸</div>
                                <div>æ¢…èŠ± (1:3.5)</div>
                            </div>
                            <div class="suit-btn" data-suit="spades">
                                <div class="suit-icon">â™ ï¸</div>
                                <div>é»‘æ¡ƒ (1:3.5)</div>
                            </div>
                            <div class="suit-btn" data-suit="joker">
                                <div class="suit-icon">ğŸƒ</div>
                                <div>ç‹ç‰Œ (1:20)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="houseInterface" class="interface">
            <div class="stats-container">
                <h2 style="text-align: center; margin-bottom: 30px;">ğŸ“ˆ åº„å®¶ç»Ÿè®¡</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="houseProfit">$0</div>
                        <div class="stat-label">æ€»æ”¶ç›Š</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">æ¸¸æˆå±€æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalBets">$0</div>
                        <div class="stat-label">æ€»æŠ•æ³¨é¢</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalPayouts">$0</div>
                        <div class="stat-label">æ€»èµ”ä»˜é¢</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="houseEdge">0%</div>
                        <div class="stat-label">åº„å®¶ä¼˜åŠ¿</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgBetPerGame">$0</div>
                        <div class="stat-label">å¹³å‡æ¯å±€æŠ•æ³¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="heartsCount">0</div>
                        <div class="stat-label">â™¥ï¸ çº¢æ¡ƒ (24.1%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="diamondsCount">0</div>
                        <div class="stat-label">â™¦ï¸ æ–¹ç‰‡ (24.1%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="clubsCount">0</div>
                        <div class="stat-label">â™£ï¸ æ¢…èŠ± (24.1%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="spadesCount">0</div>
                        <div class="stat-label">â™ ï¸ é»‘æ¡ƒ (24.1%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="jokerCount">0</div>
                        <div class="stat-label">ğŸƒ ç‹ç‰Œ (3.7%)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="profitMargin">0%</div>
                        <div class="stat-label">åˆ©æ¶¦ç‡</div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button id="resetStats" class="btn btn-danger">ğŸ”„ é‡ç½®ç»Ÿè®¡</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        class CardGame {
            constructor() {
                this.suits = ['hearts', 'diamonds', 'clubs', 'spades', 'joker'];
                this.suitNames = {
                    hearts: 'çº¢æ¡ƒ',
                    diamonds: 'æ–¹ç‰‡', 
                    clubs: 'æ¢…èŠ±',
                    spades: 'é»‘æ¡ƒ',
                    joker: 'ç‹ç‰Œ'
                };
                this.housePassword = '068162';
                this.isHouseAuthenticated = false;
                this.suitIcons = {
                    hearts: 'â™¥ï¸',
                    diamonds: 'â™¦ï¸',
                    clubs: 'â™£ï¸',
                    spades: 'â™ ï¸',
                    joker: 'ğŸƒ'
                };
                this.payouts = {
                    hearts: 3.5,    // 13/54æ¦‚ç‡ï¼Œèµ”ç‡1:3.5
                    diamonds: 3.5,  // 13/54æ¦‚ç‡ï¼Œèµ”ç‡1:3.5  
                    clubs: 3.5,     // 13/54æ¦‚ç‡ï¼Œèµ”ç‡1:3.5
                    spades: 3.5,    // 13/54æ¦‚ç‡ï¼Œèµ”ç‡1:3.5
                    joker: 20       // 2/54æ¦‚ç‡ï¼Œèµ”ç‡1:20
                };
                
                this.balance = 1000;
                this.selectedChip = 1;
                this.currentBets = {};
                this.isDrawing = false;
                this.history = [];
                this.stats = {
                    totalGames: 0,
                    houseProfit: 0,
                    totalPlayerBets: 0,
                    totalPayouts: 0,
                    suitCounts: {
                        hearts: 0,
                        diamonds: 0,
                        clubs: 0,
                        spades: 0,
                        joker: 0
                    }
                };
                
                this.init();
            }
            
            init() {
                this.bindEvents();
                this.updateDisplay();
                this.loadStats();
            }
            
            bindEvents() {
                // ç•Œé¢åˆ‡æ¢
                document.getElementById('playerView').addEventListener('click', () => this.switchInterface('player'));
                document.getElementById('houseView').addEventListener('click', () => this.showPasswordModal());
                
                // å¯†ç éªŒè¯
                document.getElementById('passwordSubmit').addEventListener('click', () => this.verifyPassword());
                document.getElementById('passwordCancel').addEventListener('click', () => this.hidePasswordModal());
                document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.verifyPassword();
                    }
                });
                
                // ç­¹ç é€‰æ‹©
                document.querySelectorAll('.chip').forEach(chip => {
                    chip.addEventListener('click', (e) => {
                        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
                        e.target.classList.add('selected');
                        this.selectedChip = parseInt(e.target.dataset.value);
                    });
                });
                
                // èŠ±è‰²æŠ•æ³¨
                document.querySelectorAll('.suit-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const suit = e.currentTarget.dataset.suit;
                        this.placeBet(suit);
                    });
                });
                
                // æ§åˆ¶æŒ‰é’®
                document.getElementById('drawBtn').addEventListener('click', () => this.drawCard());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearBets());
                document.getElementById('resetStats').addEventListener('click', () => this.resetStats());
            }
            
            showPasswordModal() {
                if (this.isHouseAuthenticated) {
                    this.switchInterface('house');
                    return;
                }
                document.getElementById('passwordModal').classList.remove('hidden');
                document.getElementById('passwordInput').focus();
                document.getElementById('passwordError').style.display = 'none';
            }
            
            hidePasswordModal() {
                document.getElementById('passwordModal').classList.add('hidden');
                document.getElementById('passwordInput').value = '';
                document.getElementById('passwordError').style.display = 'none';
            }
            
            verifyPassword() {
                const inputPassword = document.getElementById('passwordInput').value;
                if (inputPassword === this.housePassword) {
                    this.isHouseAuthenticated = true;
                    this.hidePasswordModal();
                    this.switchInterface('house');
                } else {
                    document.getElementById('passwordError').style.display = 'block';
                    document.getElementById('passwordInput').value = '';
                    document.getElementById('passwordInput').focus();
                }
            }
            
            switchInterface(type) {
                document.querySelectorAll('.interface').forEach(i => i.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                
                if (type === 'player') {
                    document.getElementById('playerInterface').classList.add('active');
                    document.getElementById('playerView').classList.add('active');
                } else {
                    document.getElementById('houseInterface').classList.add('active');
                    document.getElementById('houseView').classList.add('active');
                    this.updateStatsDisplay();
                }
            }
            
            placeBet(suit) {
                if (this.isDrawing) return;
                if (this.balance < this.selectedChip) {
                    if (this.balance === 0) {
                        alert('ç­¹ç å·²ç”¨å®Œï¼è¯·è”ç³»è€å§œè·å–ç­¹ç  ğŸ’°');
                    } else {
                        alert('ä½™é¢ä¸è¶³ï¼è¯·é€‰æ‹©æ›´å°é¢é¢çš„ç­¹ç æˆ–è”ç³»è€å§œè·å–ç­¹ç  ğŸ’°');
                    }
                    return;
                }
                
                this.balance -= this.selectedChip;
                this.currentBets[suit] = (this.currentBets[suit] || 0) + this.selectedChip;
                this.updateDisplay();
            }
            
            clearBets() {
                if (this.isDrawing) return;
                
                Object.values(this.currentBets).forEach(amount => {
                    this.balance += amount;
                });
                this.currentBets = {};
                this.updateDisplay();
            }
            
            drawCard() {
                if (this.isDrawing || Object.keys(this.currentBets).length === 0) {
                    if (Object.keys(this.currentBets).length === 0) {
                        alert('è¯·å…ˆä¸‹æ³¨ï¼');
                    }
                    return;
                }
                
                this.isDrawing = true;
                document.getElementById('status').textContent = 'æŠ½ç‰Œä¸­...';
                document.getElementById('drawBtn').disabled = true;
                
                // ç¿»ç‰ŒåŠ¨ç”»
                const cardDisplay = document.getElementById('cardDisplay');
                cardDisplay.classList.add('flipping');
                
                setTimeout(() => {
                    // æŒ‰çœŸå®æ‰‘å…‹ç‰Œæ¦‚ç‡é€‰æ‹©ç»“æœ
                    const result = this.getRandomSuitWithRealProbability();
                    
                    // æ˜¾ç¤ºç»“æœ
                    cardDisplay.className = `card-display suit-${result}`;
                    cardDisplay.innerHTML = `<div style="font-size: 80px;">${this.suitIcons[result]}</div>`;
                    
                    setTimeout(() => {
                        this.finishDraw(result);
                    }, 1000);
                }, 500);
            }
            
            getRandomSuitWithRealProbability() {
                // æ¨¡æ‹Ÿ54å¼ ç‰Œï¼šçº¢æ¡ƒ13å¼ ï¼Œæ–¹ç‰‡13å¼ ï¼Œæ¢…èŠ±13å¼ ï¼Œé»‘æ¡ƒ13å¼ ï¼Œç‹ç‰Œ2å¼ 
                const cards = [];
                
                // æ·»åŠ æ™®é€šèŠ±è‰²å„13å¼ 
                for (let i = 0; i < 13; i++) {
                    cards.push('hearts');
                    cards.push('diamonds');
                    cards.push('clubs');
                    cards.push('spades');
                }
                
                // æ·»åŠ 2å¼ ç‹ç‰Œ
                cards.push('joker');
                cards.push('joker');
                
                // éšæœºé€‰æ‹©ä¸€å¼ 
                const randomIndex = Math.floor(Math.random() * cards.length);
                return cards[randomIndex];
            }
            
            finishDraw(result) {
                console.log(`æŠ½ç‰Œç»“æœ: ${this.suitNames[result]}`);
                
                // è®¡ç®—å¥–é‡‘
                let winnings = 0;
                const totalBetAmount = Object.values(this.currentBets).reduce((sum, amount) => sum + amount, 0);
                
                if (this.currentBets[result]) {
                    winnings = this.currentBets[result] * (this.payouts[result] + 1);
                }
                
                this.balance += winnings;
                
                // æ›´æ–°ç»Ÿè®¡
                this.stats.totalGames++;
                this.stats.totalPlayerBets += totalBetAmount;
                this.stats.totalPayouts += winnings;
                this.stats.houseProfit += totalBetAmount - winnings;
                this.stats.suitCounts[result]++;
                this.saveStats();
                
                // æ·»åŠ åˆ°å†å²
                this.history.unshift(result);
                if (this.history.length > 20) {
                    this.history.pop();
                }
                
                // æ˜¾ç¤ºç»“æœ
                this.showResult(result, winnings);
                
                // é‡ç½®
                this.currentBets = {};
                this.isDrawing = false;
                document.getElementById('status').textContent = 'ç­‰å¾…ä¸‹æ³¨';
                document.getElementById('drawBtn').disabled = false;
                
                setTimeout(() => {
                    document.getElementById('result').classList.add('hidden');
                    // é‡ç½®å¡ç‰Œæ˜¾ç¤º
                    const cardDisplay = document.getElementById('cardDisplay');
                    cardDisplay.className = 'card-display card-back';
                    cardDisplay.innerHTML = 'ğŸ´<br>å–œä»å¤©é™';
                    this.updateDisplay();
                }, 3000);
            }
            
            showResult(result, winnings) {
                const resultDiv = document.getElementById('result');
                const resultSuit = document.getElementById('resultSuit');
                const resultText = document.getElementById('resultText');
                
                resultSuit.textContent = this.suitIcons[result];
                resultSuit.className = `result-suit suit-${result}`;
                
                if (winnings > 0) {
                    resultText.textContent = `ğŸ‰ æ­å–œï¼æŠ½ä¸­${this.suitNames[result]}ï¼Œèµ¢å¾— $${winnings}ï¼`;
                    resultText.style.color = '#4CAF50';
                } else {
                    resultText.textContent = `ğŸ˜” å¾ˆé—æ†¾ï¼ŒæŠ½ä¸­${this.suitNames[result]}ï¼Œæ²¡æœ‰ä¸­å¥–`;
                    resultText.style.color = '#ff6b6b';
                }
                
                resultDiv.classList.remove('hidden');
            }
            
            updateDisplay() {
                document.getElementById('balance').textContent = this.balance;
                
                // æ›´æ–°æŠ¼æ³¨æ˜¾ç¤º
                const betsList = document.getElementById('betsList');
                const totalBet = document.getElementById('totalBet');
                
                betsList.innerHTML = '';
                let total = 0;
                
                Object.entries(this.currentBets).forEach(([suit, amount]) => {
                    const div = document.createElement('div');
                    div.innerHTML = `${this.suitIcons[suit]} ${this.suitNames[suit]}: $${amount}`;
                    div.style.marginBottom = '5px';
                    betsList.appendChild(div);
                    total += amount;
                });
                
                totalBet.textContent = total;
                
                // æ¸…é™¤æ—§çš„æŠ¼æ³¨æ˜¾ç¤º
                document.querySelectorAll('.bet-amount').forEach(el => el.remove());
                
                // æ˜¾ç¤ºæ–°çš„æŠ¼æ³¨
                Object.entries(this.currentBets).forEach(([suit, amount]) => {
                    const btn = document.querySelector(`[data-suit="${suit}"]`);
                    if (btn) {
                        const amountEl = document.createElement('div');
                        amountEl.className = 'bet-amount';
                        amountEl.textContent = amount;
                        btn.appendChild(amountEl);
                    }
                });
                
                // æ›´æ–°å†å²è®°å½•
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';
                this.history.forEach(suit => {
                    const item = document.createElement('div');
                    item.className = `history-item suit-${suit}`;
                    item.textContent = this.suitIcons[suit];
                    historyList.appendChild(item);
                });
            }
            
            updateStatsDisplay() {
                document.getElementById('houseProfit').textContent = `$${this.stats.houseProfit}`;
                document.getElementById('totalGames').textContent = this.stats.totalGames;
                document.getElementById('totalBets').textContent = `$${this.stats.totalPlayerBets}`;
                document.getElementById('totalPayouts').textContent = `$${this.stats.totalPayouts}`;
                
                const houseEdge = this.stats.totalPlayerBets > 0 ? 
                    ((this.stats.houseProfit / this.stats.totalPlayerBets) * 100).toFixed(2) : 0;
                document.getElementById('houseEdge').textContent = `${houseEdge}%`;
                
                const avgBet = this.stats.totalGames > 0 ? 
                    (this.stats.totalPlayerBets / this.stats.totalGames).toFixed(2) : 0;
                document.getElementById('avgBetPerGame').textContent = `$${avgBet}`;
                
                const profitMargin = this.stats.totalPlayerBets > 0 ? 
                    ((this.stats.houseProfit / this.stats.totalPlayerBets) * 100).toFixed(2) : 0;
                document.getElementById('profitMargin').textContent = `${profitMargin}%`;
                
                // æ›´æ–°å„èŠ±è‰²ç»Ÿè®¡
                Object.entries(this.stats.suitCounts).forEach(([suit, count]) => {
                    const element = document.getElementById(`${suit}Count`);
                    if (element) {
                        element.textContent = count;
                    }
                });
            }
            
            saveStats() {
                localStorage.setItem('cardGameStats', JSON.stringify(this.stats));
            }
            
            loadStats() {
                const saved = localStorage.getItem('cardGameStats');
                if (saved) {
                    this.stats = JSON.parse(saved);
                }
            }
            
            resetStats() {
                if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿ')) {
                    this.stats = {
                        totalGames: 0,
                        houseProfit: 0,
                        totalPlayerBets: 0,
                        suitCounts: {
                            hearts: 0,
                            diamonds: 0,
                            clubs: 0,
                            spades: 0,
                            joker: 0
                        }
                    };
                    this.saveStats();
                    this.updateStatsDisplay();
                }
            }
        }
        
        // å¯åŠ¨æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            new CardGame();
        });
    </script>
</body>
</html>