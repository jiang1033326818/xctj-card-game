<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç®¡ç†å‘˜é¢æ¿ - å–œä»å¤©é™</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      background-color: #2196F3;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    h1 {
      margin: 0;
      font-size: 24px;
    }
    .user-info {
      display: flex;
      align-items: center;
    }
    .user-info span {
      margin-right: 15px;
    }
    .btn {
      padding: 8px 16px;
      background-color: #1976D2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    .btn:hover {
      background-color: #0D47A1;
    }
    .btn-edit {
      background-color: #4CAF50;
    }
    .btn-edit:hover {
      background-color: #388E3C;
    }
    .btn-save {
      background-color: #FF9800;
    }
    .btn-save:hover {
      background-color: #F57C00;
    }
    .card {
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h2 {
      margin-top: 0;
      color: #2196F3;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }
    .stat-card {
      background-color: #f9f9f9;
      border-radius: 5px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #2196F3;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .win {
      color: #4CAF50;
    }
    .lose {
      color: #F44336;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    .error-message {
      color: #F44336;
      padding: 10px;
      background-color: #FFEBEE;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .success-message {
      color: #4CAF50;
      padding: 10px;
      background-color: #E8F5E9;
      border-radius: 4px;
      margin-bottom: 15px;
      display: none;
    }
    .balance-input {
      width: 100px;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    /* æ¨¡æ€æ¡†æ ·å¼ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      border-radius: 5px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h3 {
      margin: 0;
      color: #2196F3;
    }
    .close-btn {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      color: #aaa;
    }
    .close-btn:hover {
      color: #333;
    }
    .modal-body {
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .modal-footer {
      text-align: right;
    }
    
    /* æœ€èµšé’±æ¸¸æˆç‰¹æ®Šæ ·å¼ */
    .stat-card.winner {
      background: linear-gradient(135deg, #4CAF50, #45a049);
      color: white;
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
    }
    
    .stat-card.winner .stat-label {
      color: #E8F5E9;
    }
    
    .stat-card.winner .stat-value {
      color: white;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ® å–œä»å¤©é™ - ç®¡ç†å‘˜é¢æ¿</h1>
      <div class="user-info">
        <span id="username">åŠ è½½ä¸­...</span>
        <span id="balance">ä½™é¢: åŠ è½½ä¸­...</span>
        <button class="btn" onclick="logout()">ç™»å‡º</button>
      </div>
    </header>
    
    <div class="card">
      <h2>ğŸ“Š ç³»ç»Ÿç»Ÿè®¡ - æ€»ä½“æ•°æ®</h2>
      <div id="stats-loading" class="loading">åŠ è½½ç»Ÿè®¡æ•°æ®ä¸­...</div>
      <div id="stats-error" class="error-message" style="display: none;"></div>
      <div id="stats-container" class="stats-grid" style="display: none;">
        <div class="stat-card">
          <div class="stat-label">æ€»æ¸¸æˆæ¬¡æ•°</div>
          <div id="total-games" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ€»ä¸‹æ³¨é‡‘é¢</div>
          <div id="total-bets" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ€»æ´¾å½©é‡‘é¢</div>
          <div id="total-payouts" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">åº„å®¶ç›ˆåˆ©</div>
          <div id="house-profit" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ğŸ’° æœ€èµšé’±æ¸¸æˆ</div>
          <div id="most-profitable-game" class="stat-value">åŠ è½½ä¸­...</div>
          <div class="stat-label" id="most-profitable-profit" style="font-size: 12px; color: #4CAF50;"></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ğŸš€ æ•ˆç‡æœ€é«˜æ¸¸æˆ</div>
          <div id="most-efficient-game" class="stat-value">åŠ è½½ä¸­...</div>
          <div class="stat-label" id="most-efficient-avg" style="font-size: 12px; color: #FF9800;">å¹³å‡æ¯å±€ç›ˆåˆ©</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>ğŸ† æ¸¸æˆç›ˆåˆ©å¯¹æ¯”åˆ†æ</h2>
      <div id="game-comparison-container" class="stats-grid" style="display: none;">
        <div class="stat-card">
          <div class="stat-label">ğŸ† å–œä»å¤©é™</div>
          <div id="xctj-comparison-profit" class="stat-value">0</div>
          <div class="stat-label" style="font-size: 12px; margin-top: 5px;">
            <span id="xctj-comparison-games">0å±€</span> | 
            <span id="xctj-comparison-avg">å¹³å‡: 0</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ğŸ¦ é£ç¦½èµ°å…½</div>
          <div id="animals-comparison-profit" class="stat-value">0</div>
          <div class="stat-label" style="font-size: 12px; margin-top: 5px;">
            <span id="animals-comparison-games">0å±€</span> | 
            <span id="animals-comparison-avg">å¹³å‡: 0</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>ğŸ† å–œä»å¤©é™æ¸¸æˆç»Ÿè®¡</h2>
      <div id="xctj-stats-container" class="stats-grid" style="display: none;">
        <div class="stat-card">
          <div class="stat-label">æ¸¸æˆæ¬¡æ•°</div>
          <div id="xctj-games" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æŠ•æ³¨é‡‘é¢</div>
          <div id="xctj-bets" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ´¾å½©é‡‘é¢</div>
          <div id="xctj-payouts" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">åº„å®¶ç›ˆåˆ©</div>
          <div id="xctj-profit" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">çº¢æ¡ƒæ¬¡æ•°</div>
          <div id="hearts-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ–¹å—æ¬¡æ•°</div>
          <div id="diamonds-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ¢…èŠ±æ¬¡æ•°</div>
          <div id="clubs-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">é»‘æ¡ƒæ¬¡æ•°</div>
          <div id="spades-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å°ä¸‘æ¬¡æ•°</div>
          <div id="joker-count" class="stat-value">0</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ¦ é£ç¦½èµ°å…½æ¸¸æˆç»Ÿè®¡</h2>
      <div id="animals-stats-container" class="stats-grid" style="display: none;">
        <div class="stat-card">
          <div class="stat-label">æ¸¸æˆæ¬¡æ•°</div>
          <div id="animals-games" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æŠ•æ³¨é‡‘é¢</div>
          <div id="animals-bets" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">æ´¾å½©é‡‘é¢</div>
          <div id="animals-payouts" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">åº„å®¶ç›ˆåˆ©</div>
          <div id="animals-profit" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ç‹®å­ ğŸ¦</div>
          <div id="lion-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ç†ŠçŒ« ğŸ¼</div>
          <div id="panda-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">è€é¹° ğŸ¦…</div>
          <div id="eagle-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">çŒ´å­ ğŸµ</div>
          <div id="monkey-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å…”å­ ğŸ°</div>
          <div id="rabbit-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">å­”é›€ ğŸ¦š</div>
          <div id="peacock-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">é¸½å­ ğŸ•Šï¸</div>
          <div id="pigeon-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">ç‡•å­ ğŸ¦</div>
          <div id="swallow-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">é‡‘é²¨ ğŸ¦ˆ</div>
          <div id="gold-shark-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">é“¶é²¨ ğŸ¦ˆ</div>
          <div id="silver-shark-count" class="stat-value">0</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>å¤šç¦å¤šè´¢è§’å­æœºç»Ÿè®¡</h2>
      <div id="slot-stats-loading" class="loading">åŠ è½½ç»Ÿè®¡æ•°æ®ä¸­...</div>
      <div id="slot-stats-error" class="error-message" style="display: none;"></div>
      <div id="slot-stats-container" style="display: none;">
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">æ€»æ¸¸æˆå±€æ•°</div>
            <div class="stat-value" id="slot-games">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">æ€»ä¸‹æ³¨é‡‘é¢</div>
            <div class="stat-value" id="slot-bets">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">æ€»æ´¾å½©é‡‘é¢</div>
            <div class="stat-value" id="slot-payouts">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">åº„å®¶ç›ˆåˆ©</div>
            <div class="stat-value" id="slot-profit">0</div>
          </div>
        </div>
        
        <h3>å¤§å¥–ç»Ÿè®¡</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">è¶…çº§å¤§å¥–</div>
            <div class="stat-value" id="slot-super-jackpot">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å¤šç¦å·¨å¥–</div>
            <div class="stat-value" id="slot-grand-jackpot">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å¤šè´¢å¤§å¥–</div>
            <div class="stat-value" id="slot-major-jackpot">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å¤šå–œä¸­å¥–</div>
            <div class="stat-value" id="slot-minor-jackpot">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å¤šå¯¿å°å¥–</div>
            <div class="stat-value" id="slot-mini-jackpot">0</div>
          </div>
        </div>
        
        <h3>åŠŸèƒ½ç»Ÿè®¡</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Scatterç¬¦å·</div>
            <div class="stat-value" id="slot-scatter-count">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å…è´¹æ—‹è½¬</div>
            <div class="stat-value" id="slot-free-spins">0</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>ç”¨æˆ·åˆ—è¡¨</h2>
      <div id="users-loading" class="loading">åŠ è½½ç”¨æˆ·æ•°æ®ä¸­...</div>
      <div id="users-error" class="error-message" style="display: none;"></div>
      <div id="users-success" class="success-message" style="display: none;"></div>
      <div id="users-container" style="display: none;">
        <table id="users-table">
          <thead>
            <tr>
              <th>ç”¨æˆ·å</th>
              <th>ä½™é¢</th>
              <th>è§’è‰²</th>
              <th>åˆ›å»ºæ—¶é—´</th>
              <th>æœ€åç™»å½•</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody id="users-tbody">
            <!-- ç”¨æˆ·æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="card">
      <h2>æ¸¸æˆè®°å½•</h2>
      <div id="records-controls" style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center;">
        <div>
          <label for="username-filter">ç”¨æˆ·ç­›é€‰:</label>
          <input type="text" id="username-filter" placeholder="è¾“å…¥ç”¨æˆ·å" style="padding: 5px; margin-left: 5px;">
        </div>
        <button class="btn" onclick="filterRecords()">ç­›é€‰</button>
        <button class="btn" onclick="clearFilter()">æ¸…é™¤ç­›é€‰</button>
      </div>
      
      <div id="records-loading" class="loading">åŠ è½½æ¸¸æˆè®°å½•ä¸­...</div>
      <div id="records-error" class="error-message" style="display: none;"></div>
      <div id="records-container" style="display: none;">
        <table id="records-table">
          <thead>
            <tr>
              <th>ç”¨æˆ·</th>
              <th>æ¸¸æˆç±»å‹</th>
              <th>ä¸‹æ³¨å†…å®¹</th>
              <th>ç»“æœ</th>
              <th>ä¸‹æ³¨é‡‘é¢</th>
              <th>è¾“èµ¢</th>
              <th>èµ¢å–é‡‘é¢</th>
              <th>æ¸¸æˆåä½™é¢</th>
              <th>æ—¶é—´</th>
            </tr>
          </thead>
          <tbody id="records-tbody">
            <!-- æ¸¸æˆè®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
          </tbody>
        </table>
        
        <!-- åˆ†é¡µæ§ä»¶ -->
        <div id="pagination-controls" style="margin-top: 15px; text-align: center; display: flex; justify-content: center; align-items: center; gap: 10px;">
          <button id="prev-page" class="btn" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
          <span id="page-info">ç¬¬ <span id="current-page">1</span> é¡µï¼Œå…± <span id="total-pages">1</span> é¡µ</span>
          <button id="next-page" class="btn" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
          <div style="margin-left: 20px;">
            <label for="page-size">æ¯é¡µæ˜¾ç¤º:</label>
            <select id="page-size" onchange="changePageSize()">
              <option value="5">5æ¡</option>
              <option value="10" selected>10æ¡</option>
              <option value="20">20æ¡</option>
              <option value="50">50æ¡</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¿®æ”¹ä½™é¢æ¨¡æ€æ¡† -->
  <div id="edit-balance-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ä¿®æ”¹ç”¨æˆ·ä½™é¢</h3>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>ç”¨æˆ·å:</label>
          <input type="text" id="modal-username" readonly>
        </div>
        <div class="form-group">
          <label>å½“å‰ä½™é¢:</label>
          <input type="text" id="modal-current-balance" readonly>
        </div>
        <div class="form-group">
          <label>æ–°ä½™é¢:</label>
          <input type="number" id="modal-new-balance" min="0" step="100">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">å–æ¶ˆ</button>
        <button class="btn btn-save" onclick="saveBalance()">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let currentUsers = [];
    let editingUserId = null;
    let currentRecordsPage = 1;
    let currentRecordsLimit = 10;
    let currentRecordsUsername = '';
    let totalRecordsPages = 1;

    // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥ç™»å½•çŠ¶æ€å¹¶åŠ è½½æ•°æ®
    window.addEventListener('load', async () => {
      try {
        // è·å–token
        const token = localStorage.getItem('token');
        if (!token) {
          // æœªç™»å½•ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
          window.location.href = '/login.html';
          return;
        }
        
        // æ£€æŸ¥ç™»å½•çŠ¶æ€
        const userResponse = await fetch('/api/user', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!userResponse.ok) {
          // æœªç™»å½•æˆ–tokenæ— æ•ˆï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µé¢
          localStorage.removeItem('token');
          window.location.href = '/login.html';
          return;
        }
        
        const userData = await userResponse.json();
        
        // æ£€æŸ¥æ˜¯å¦ä¸ºç®¡ç†å‘˜
        if (!userData.is_admin) {
          // ä¸æ˜¯ç®¡ç†å‘˜ï¼Œé‡å®šå‘åˆ°æ¸¸æˆé¡µé¢
          window.location.href = '/game.html';
          return;
        }
        
        // æ˜¾ç¤ºç”¨æˆ·ä¿¡æ¯
        document.getElementById('username').textContent = userData.username;
        document.getElementById('balance').textContent = `ä½™é¢: ${userData.balance}`;
        
        // åŠ è½½ç»Ÿè®¡æ•°æ®
        loadStats();
        
        // åŠ è½½ç”¨æˆ·åˆ—è¡¨
        loadUsers();
        
        // åŠ è½½æ¸¸æˆè®°å½•
        loadGameRecords();
      } catch (error) {
        console.error('åˆå§‹åŒ–å¤±è´¥:', error);
        alert('åŠ è½½æ•°æ®å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
      }
    });

    // åŠ è½½ç»Ÿè®¡æ•°æ®
    async function loadStats() {
      try {
        // è·å–token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        const response = await fetch('/api/house_stats', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
            return;
          }
          throw new Error('è·å–ç»Ÿè®¡æ•°æ®å¤±è´¥');
        }
        
        const data = await response.json();
        
        if (!data.success || !data.stats) {
          throw new Error('ç»Ÿè®¡æ•°æ®æ ¼å¼é”™è¯¯');
        }
        
        const stats = data.stats;
        
        // æ˜¾ç¤ºæ€»ä½“ç»Ÿè®¡æ•°æ®
        document.getElementById('total-games').textContent = stats.totalGames;
        document.getElementById('total-bets').textContent = stats.totalBets;
        document.getElementById('total-payouts').textContent = stats.totalPayouts;
        document.getElementById('house-profit').textContent = stats.houseProfit;
        
        // æ˜¾ç¤ºæœ€èµšé’±æ¸¸æˆä¿¡æ¯
        if (stats.mostProfitableGame) {
          document.getElementById('most-profitable-game').textContent = stats.mostProfitableGame.name;
          document.getElementById('most-profitable-profit').textContent = `ç›ˆåˆ©: ${stats.mostProfitableGame.profit} (å…±${stats.mostProfitableGame.games}å±€)`;
        }
        
        // æ˜¾ç¤ºæ•ˆç‡æœ€é«˜æ¸¸æˆä¿¡æ¯
        if (stats.mostEfficientGame) {
          document.getElementById('most-efficient-game').textContent = stats.mostEfficientGame.name;
          document.getElementById('most-efficient-avg').textContent = `å¹³å‡æ¯å±€: ${stats.mostEfficientGame.avgProfitPerGame}`;
        }
        
        // æ˜¾ç¤ºæ¸¸æˆå¯¹æ¯”æ•°æ®
        if (stats.gameComparison) {
          const xctjData = stats.gameComparison.find(game => game.key === 'xctj');
          const animalsData = stats.gameComparison.find(game => game.key === 'animals');
          const slotData = stats.gameComparison.find(game => game.key === 'slot');
          
          // é‡ç½®æ‰€æœ‰æ ·å¼
          document.querySelector('#xctj-comparison-profit').parentElement.classList.remove('winner');
          document.querySelector('#animals-comparison-profit').parentElement.classList.remove('winner');
          
          if (xctjData) {
            document.getElementById('xctj-comparison-profit').textContent = xctjData.profit;
            document.getElementById('xctj-comparison-games').textContent = `${xctjData.games}å±€`;
            document.getElementById('xctj-comparison-avg').textContent = `å¹³å‡: ${xctjData.avgProfitPerGame}`;
          }
          
          if (animalsData) {
            document.getElementById('animals-comparison-profit').textContent = animalsData.profit;
            document.getElementById('animals-comparison-games').textContent = `${animalsData.games}å±€`;
            document.getElementById('animals-comparison-avg').textContent = `å¹³å‡: ${animalsData.avgProfitPerGame}`;
          }
          
          // ä¸ºæœ€èµšé’±æ¸¸æˆæ·»åŠ ç‰¹æ®Šæ ·å¼
          if (stats.mostProfitableGame) {
            if (stats.mostProfitableGame.key === 'xctj') {
              document.querySelector('#xctj-comparison-profit').parentElement.classList.add('winner');
            } else if (stats.mostProfitableGame.key === 'animals') {
              document.querySelector('#animals-comparison-profit').parentElement.classList.add('winner');
            }
          }
          
          // æ˜¾ç¤ºæ¸¸æˆå¯¹æ¯”å®¹å™¨
          document.getElementById('game-comparison-container').style.display = 'grid';
        }
        
        // æ˜¾ç¤ºå–œä»å¤©é™æ¸¸æˆç»Ÿè®¡
        document.getElementById('xctj-games').textContent = stats.xctjStats.totalGames;
        document.getElementById('xctj-bets').textContent = stats.xctjStats.totalBets;
        document.getElementById('xctj-payouts').textContent = stats.xctjStats.totalPayouts;
        document.getElementById('xctj-profit').textContent = stats.xctjStats.houseProfit;
        document.getElementById('hearts-count').textContent = stats.xctjStats.heartsCount;
        document.getElementById('diamonds-count').textContent = stats.xctjStats.diamondsCount;
        document.getElementById('clubs-count').textContent = stats.xctjStats.clubsCount;
        document.getElementById('spades-count').textContent = stats.xctjStats.spadesCount;
        document.getElementById('joker-count').textContent = stats.xctjStats.jokerCount;
        
        // æ˜¾ç¤ºé£ç¦½èµ°å…½æ¸¸æˆç»Ÿè®¡
        document.getElementById('animals-games').textContent = stats.animalsStats.totalGames;
        document.getElementById('animals-bets').textContent = stats.animalsStats.totalBets;
        document.getElementById('animals-payouts').textContent = stats.animalsStats.totalPayouts;
        document.getElementById('animals-profit').textContent = stats.animalsStats.houseProfit;
        document.getElementById('lion-count').textContent = stats.animalsStats.lionCount;
        document.getElementById('panda-count').textContent = stats.animalsStats.pandaCount;
        document.getElementById('eagle-count').textContent = stats.animalsStats.eagleCount;
        document.getElementById('monkey-count').textContent = stats.animalsStats.monkeyCount;
        document.getElementById('rabbit-count').textContent = stats.animalsStats.rabbitCount;
        document.getElementById('peacock-count').textContent = stats.animalsStats.peacockCount;
        document.getElementById('pigeon-count').textContent = stats.animalsStats.pigeonCount;
        document.getElementById('swallow-count').textContent = stats.animalsStats.swallowCount;
        document.getElementById('gold-shark-count').textContent = stats.animalsStats.goldSharkCount;
        document.getElementById('silver-shark-count').textContent = stats.animalsStats.silverSharkCount;
        
        // æ˜¾ç¤ºå¤šç¦å¤šè´¢è§’å­æœºæ¸¸æˆç»Ÿè®¡
        if (stats.slotStats) {
          document.getElementById('slot-games').textContent = stats.slotStats.totalGames;
          document.getElementById('slot-bets').textContent = stats.slotStats.totalBets;
          document.getElementById('slot-payouts').textContent = stats.slotStats.totalPayouts;
          document.getElementById('slot-profit').textContent = stats.slotStats.houseProfit;
          document.getElementById('slot-super-jackpot').textContent = stats.slotStats.jackpotCount.super || 0;
          document.getElementById('slot-grand-jackpot').textContent = stats.slotStats.jackpotCount.grand || 0;
          document.getElementById('slot-major-jackpot').textContent = stats.slotStats.jackpotCount.major || 0;
          document.getElementById('slot-minor-jackpot').textContent = stats.slotStats.jackpotCount.minor || 0;
          document.getElementById('slot-mini-jackpot').textContent = stats.slotStats.jackpotCount.mini || 0;
          document.getElementById('slot-scatter-count').textContent = stats.slotStats.scatterCount;
          document.getElementById('slot-free-spins').textContent = stats.slotStats.freeSpinsCount;
          
          // æ˜¾ç¤ºå¤šç¦å¤šè´¢ç»Ÿè®¡å®¹å™¨
          document.getElementById('slot-stats-container').style.display = 'block';
        } else {
          // å¦‚æœæ²¡æœ‰slotStatsæ•°æ®ï¼Œåˆå§‹åŒ–ä¸º0
          document.getElementById('slot-games').textContent = 0;
          document.getElementById('slot-bets').textContent = 0;
          document.getElementById('slot-payouts').textContent = 0;
          document.getElementById('slot-profit').textContent = 0;
          document.getElementById('slot-super-jackpot').textContent = 0;
          document.getElementById('slot-grand-jackpot').textContent = 0;
          document.getElementById('slot-major-jackpot').textContent = 0;
          document.getElementById('slot-minor-jackpot').textContent = 0;
          document.getElementById('slot-mini-jackpot').textContent = 0;
          document.getElementById('slot-scatter-count').textContent = 0;
          document.getElementById('slot-free-spins').textContent = 0;
          
          // æ˜¾ç¤ºå¤šç¦å¤šè´¢ç»Ÿè®¡å®¹å™¨
          document.getElementById('slot-stats-container').style.display = 'block';
        }
        
        // éšè—åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºç»Ÿè®¡æ•°æ®
        document.getElementById('stats-loading').style.display = 'none';
        document.getElementById('stats-container').style.display = 'grid';
        document.getElementById('game-comparison-container').style.display = 'grid';
        document.getElementById('xctj-stats-container').style.display = 'grid';
        document.getElementById('animals-stats-container').style.display = 'grid';
        
        // ç¡®ä¿å¤šç¦å¤šè´¢ç»Ÿè®¡å®¹å™¨è¢«æ˜¾ç¤º
        if (stats.slotStats) {
          document.getElementById('slot-stats-container').style.display = 'block';
        }
      } catch (error) {
        console.error('åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:', error);
        document.getElementById('stats-loading').style.display = 'none';
        document.getElementById('stats-error').textContent = 'åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥: ' + error.message;
        document.getElementById('stats-error').style.display = 'block';
      }
    }

    // åŠ è½½ç”¨æˆ·åˆ—è¡¨
    async function loadUsers() {
      try {
        // è·å–token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        const response = await fetch('/api/admin/users', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
            return;
          }
          throw new Error('è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥');
        }
        
        const data = await response.json();
        
        if (!data.success || !data.users) {
          throw new Error('ç”¨æˆ·æ•°æ®æ ¼å¼é”™è¯¯');
        }
        
        // å¤„ç†ç”¨æˆ·æ•°æ®ï¼Œç¡®ä¿æ˜¯æ•°ç»„æ ¼å¼
        let users = [];
        if (Array.isArray(data.users)) {
          users = data.users;
        } else if (typeof data.users.toArray === 'function') {
          users = await data.users.toArray();
        } else {
          users = [data.users];
        }
        
        // ä¿å­˜ç”¨æˆ·æ•°æ®åˆ°å…¨å±€å˜é‡
        currentUsers = users;
        
        // æ¸…ç©ºè¡¨æ ¼
        const tbody = document.getElementById('users-tbody');
        tbody.innerHTML = '';
        
        // æ·»åŠ ç”¨æˆ·æ•°æ®
        users.forEach(user => {
          const tr = document.createElement('tr');
          
          // æ ¼å¼åŒ–æ—¥æœŸ
          const createdAt = user.created_at ? new Date(user.created_at).toLocaleString() : 'æœªçŸ¥';
          const lastLogin = user.last_login ? new Date(user.last_login).toLocaleString() : 'ä»æœªç™»å½•';
          
          tr.innerHTML = `
            <td>${user.username || 'æœªçŸ¥'}</td>
            <td>${user.balance !== undefined ? user.balance : 'æœªçŸ¥'}</td>
            <td>${user.is_admin ? 'ç®¡ç†å‘˜' : 'æ™®é€šç”¨æˆ·'}</td>
            <td>${createdAt}</td>
            <td>${lastLogin}</td>
            <td>
              <button class="btn btn-edit" onclick="openEditBalanceModal('${user._id || user.username}')">ä¿®æ”¹ä½™é¢</button>
              ${user.username !== 'admin' && !user.is_admin ? 
                `<button class="btn" style="background-color: #F44336;" onclick="deleteUser('${user.username}')">åˆ é™¤ç”¨æˆ·</button>` : 
                ''}
            </td>
          `;
          
          tbody.appendChild(tr);
        });
        
        // éšè—åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨
        document.getElementById('users-loading').style.display = 'none';
        document.getElementById('users-container').style.display = 'block';
      } catch (error) {
        console.error('åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error);
        document.getElementById('users-loading').style.display = 'none';
        document.getElementById('users-error').textContent = 'åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥: ' + error.message;
        document.getElementById('users-error').style.display = 'block';
      }
    }

    // åŠ è½½æ¸¸æˆè®°å½•
    async function loadGameRecords(page = 1, limit = 10, username = '') {
      try {
        // æ›´æ–°å…¨å±€å˜é‡
        currentRecordsPage = page;
        currentRecordsLimit = limit;
        currentRecordsUsername = username;
        
        // è·å–token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        // æ„å»ºæŸ¥è¯¢å‚æ•°
        const params = new URLSearchParams();
        params.append('page', page);
        params.append('limit', limit);
        if (username) {
          params.append('username', username);
        }
        
        const response = await fetch(`/api/game_records?${params.toString()}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
            return;
          }
          throw new Error('è·å–æ¸¸æˆè®°å½•å¤±è´¥');
        }
        
        const data = await response.json();
        
        if (!data.success || !data.records) {
          throw new Error('æ¸¸æˆè®°å½•æ ¼å¼é”™è¯¯');
        }
        
        // æ›´æ–°åˆ†é¡µä¿¡æ¯
        totalRecordsPages = data.pagination.pages;
        document.getElementById('current-page').textContent = data.pagination.page;
        document.getElementById('total-pages').textContent = data.pagination.pages;
        
        // æ›´æ–°åˆ†é¡µæŒ‰é’®çŠ¶æ€
        document.getElementById('prev-page').disabled = data.pagination.page <= 1;
        document.getElementById('next-page').disabled = data.pagination.page >= data.pagination.pages;
        
        // æ¸…ç©ºè¡¨æ ¼
        const tbody = document.getElementById('records-tbody');
        tbody.innerHTML = '';
        
        // æ·»åŠ æ¸¸æˆè®°å½•
        data.records.forEach(record => {
          const tr = document.createElement('tr');
          
          // æ ¼å¼åŒ–æ—¥æœŸ
          const createdAt = record.created_at ? new Date(record.created_at).toLocaleString() : 'æœªçŸ¥';
          
          // å†³å®šæ¸¸æˆç±»å‹
          const gameType = record.game_type === 'animals' ? 'ğŸ¦ é£ç¦½èµ°å…½' : 
                          record.game_type === 'slot' ? 'ğŸ° å¤šç¦å¤šè´¢è§’å­æœº' : 'ğŸ† å–œä»å¤©é™';
          
          // ç¿»è¯‘èŠ±è‰²/åŠ¨ç‰©
          const translateResult = (type, result) => {
            if (type === 'animals') {
              const animalNames = {
                'lion': 'ç‹®å­ ğŸ¦',
                'panda': 'ç†ŠçŒ« ğŸ¼',
                'eagle': 'è€é¹° ğŸ¦…',
                'monkey': 'çŒ´å­ ğŸµ',
                'rabbit': 'å…”å­ ğŸ°',
                'peacock': 'å­”é›€ ğŸ¦š',
                'pigeon': 'é¸½å­ ğŸ•Šï¸',
                'swallow': 'ç‡•å­ ğŸ¦',
                'gold_shark': 'é‡‘é²¨ ğŸ¦ˆ',
                'silver_shark': 'é“¶é²¨ ğŸ¦ˆ'
              };
              return animalNames[result] || result;
            } else if (type === 'slot') {
              // å¤šç¦å¤šè´¢è§’å­æœºæ¸¸æˆç¬¦å·ç¿»è¯‘
              const symbolNames = {
                'card_10': '10',
                'card_j': 'J',
                'card_q': 'Q', 
                'card_k': 'K',
                'card_a': 'A',
                'coin': 'ğŸ’° é‡‘å¸',
                'ingot': 'ğŸ§§ é‡‘å…ƒå®',
                'lantern': 'ğŸ® ç¯ç¬¼',
                'dragon': 'ğŸ‰ é¾™',
                'wild': 'ç¦',
                'scatter': 'å›'
              };
              return symbolNames[result] || result;
            } else {
              const suitNames = {
                'hearts': 'çº¢æ¡ƒ â™¥',
                'diamonds': 'æ–¹å— â™¦',
                'clubs': 'æ¢…èŠ± â™£',
                'spades': 'é»‘æ¡ƒ â™ ',
                'joker': 'å°ä¸‘ ğŸƒ'
              };
              return suitNames[result] || result;
            }
          };
          
          // è§£æä¸‹æ³¨å†…å®¹
          let betDisplay = '';
          if (record.game_type === 'animals') {
            // é£ç¦½èµ°å…½æ¸¸æˆ
            try {
              if (record.bet_data && record.bet_data.startsWith('{')) {
                const bets = JSON.parse(record.bet_data);
                const betEntries = Object.entries(bets)
                  .filter(([_, amount]) => amount > 0)
                  .map(([animal, amount]) => `${translateResult('animals', animal)}:${amount}`)
                  .join(', ');
                betDisplay = betEntries || 'æœªçŸ¥';
              } else {
                betDisplay = 'æœªçŸ¥';
              }
            } catch (e) {
              betDisplay = 'è§£æé”™è¯¯';
            }
          } else if (record.game_type === 'slot') {
            // å¤šç¦å¤šè´¢è§’å­æœºæ¸¸æˆ
            try {
              // è§’å­æœºæ¸¸æˆçš„ä¸‹æ³¨é‡‘é¢ç›´æ¥ä½¿ç”¨amountå­—æ®µ
              betDisplay = record.bet_amount || record.amount || 'æœªçŸ¥';
            } catch (e) {
              betDisplay = 'è§£æé”™è¯¯';
            }
          } else {
            // å–œä»å¤©é™æ¸¸æˆ
            try {
              if (record.bet_suit && record.bet_suit.startsWith('{')) {
                const bets = JSON.parse(record.bet_suit);
                const betEntries = Object.entries(bets)
                  .filter(([_, amount]) => amount > 0)
                  .map(([suit, amount]) => `${translateResult('xctj', suit)}:${amount}`)
                  .join(', ');
                betDisplay = betEntries || translateResult('xctj', record.bet_suit);
              } else {
                betDisplay = translateResult('xctj', record.bet_suit) || 'æœªçŸ¥';
              }
            } catch (e) {
              betDisplay = translateResult('xctj', record.bet_suit) || 'æœªçŸ¥';
            }
          }
          
          // è·å–ç»“æœ
          let resultDisplay = 'æœªçŸ¥';
          if (record.game_type === 'animals') {
            resultDisplay = translateResult('animals', record.result_animal) || 'æœªçŸ¥';
          } else if (record.game_type === 'slot') {
            // å¯¹äºè§’å­æœºæ¸¸æˆï¼Œç»“æœæ˜¯ reels_result å­—æ®µ
            try {
              if (record.reels_result) {
                const reels = typeof record.reels_result === 'string' ? 
                  JSON.parse(record.reels_result) : record.reels_result;
                // æ˜¾ç¤ºä¸­é—´è¡Œçš„ç»“æœ
                if (reels && reels.length >= 5) {
                  resultDisplay = reels.map((reel, index) => {
                    // ç¡®ä¿reelæ˜¯æ•°ç»„ä¸”æœ‰è¶³å¤Ÿå…ƒç´ 
                    if (reel && Array.isArray(reel) && reel.length >= 3) {
                      return translateResult('slot', reel[2]);
                    }
                    return 'æœªçŸ¥';
                  }).join(' | ');
                } else {
                  resultDisplay = 'æœªçŸ¥';
                }
              } else {
                resultDisplay = 'æ— ç»“æœ';
              }
            } catch (e) {
              console.error('è§£æè§’å­æœºç»“æœé”™è¯¯:', e);
              resultDisplay = 'è§£æé”™è¯¯';
            }
          } else {
            resultDisplay = translateResult('xctj', record.result_suit) || 'æœªçŸ¥';
          }
          
          // è®¡ç®—è¾“èµ¢çŠ¶æ€
          const netResult = (record.win_amount || 0) - (record.amount || 0);
          const isWin = netResult > 0;
          const winLoseText = isWin ? `èµ¢ ${netResult}` : `è¾“ ${Math.abs(netResult)}`;
          
          // è·å–æ¸¸æˆåä½™é¢
          const afterBalance = record.new_balance !== undefined ? record.new_balance : 'æœªçŸ¥';
          
          tr.innerHTML = `
            <td>${record.username || 'æœªçŸ¥'}</td>
            <td>${gameType}</td>
            <td>${betDisplay}</td>
            <td>${resultDisplay}</td>
            <td>${record.amount || 'æœªçŸ¥'}</td>
            <td class="${isWin ? 'win' : 'lose'}">${winLoseText}</td>
            <td>${record.win_amount || 0}</td>
            <td>${afterBalance}</td>
            <td>${createdAt}</td>
          `;

          tbody.appendChild(tr);
        });
        
        // éšè—åŠ è½½æç¤ºï¼Œæ˜¾ç¤ºæ¸¸æˆè®°å½•
        document.getElementById('records-loading').style.display = 'none';
        document.getElementById('records-container').style.display = 'block';
      } catch (error) {
        console.error('åŠ è½½æ¸¸æˆè®°å½•å¤±è´¥:', error);
        document.getElementById('records-loading').style.display = 'none';
        document.getElementById('records-error').textContent = 'åŠ è½½æ¸¸æˆè®°å½•å¤±è´¥: ' + error.message;
        document.getElementById('records-error').style.display = 'block';
      }
    }

    // æ‰“å¼€ä¿®æ”¹ä½™é¢æ¨¡æ€æ¡†
    function openEditBalanceModal(userId) {
      // æŸ¥æ‰¾ç”¨æˆ·
      const user = currentUsers.find(u => u._id === userId);
      if (!user) {
        alert('æ‰¾ä¸åˆ°ç”¨æˆ·ä¿¡æ¯');
        return;
      }
      
      // è®¾ç½®æ¨¡æ€æ¡†æ•°æ®
      document.getElementById('modal-username').value = user.username;
      document.getElementById('modal-current-balance').value = user.balance;
      document.getElementById('modal-new-balance').value = user.balance;
      
      // ä¿å­˜å½“å‰ç¼–è¾‘çš„ç”¨æˆ·ID
      editingUserId = userId;
      
      // æ˜¾ç¤ºæ¨¡æ€æ¡†
      document.getElementById('edit-balance-modal').style.display = 'block';
    }

    // å…³é—­æ¨¡æ€æ¡†
    function closeModal() {
      document.getElementById('edit-balance-modal').style.display = 'none';
      editingUserId = null;
    }

    // ä¿å­˜ä½™é¢ä¿®æ”¹
    async function saveBalance() {
      try {
        const newBalance = parseInt(document.getElementById('modal-new-balance').value);
        
        // éªŒè¯è¾“å…¥
        if (isNaN(newBalance) || newBalance < 0) {
          alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ä½™é¢');
          return;
        }
        
        // è·å–token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        // å‘é€è¯·æ±‚
        const response = await fetch('/api/update_balance', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            username: document.getElementById('modal-username').value,
            balance: newBalance
          })
        });
        
        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || 'ä¿®æ”¹ä½™é¢å¤±è´¥');
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        closeModal();
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        const successMsg = document.getElementById('users-success');
        successMsg.textContent = 'ä½™é¢ä¿®æ”¹æˆåŠŸ';
        successMsg.style.display = 'block';
        
        // é‡æ–°åŠ è½½ç”¨æˆ·åˆ—è¡¨
        setTimeout(() => {
          loadUsers();
          successMsg.style.display = 'none';
        }, 1500);
      } catch (error) {
        console.error('ä¿®æ”¹ä½™é¢å¤±è´¥:', error);
        alert('ä¿®æ”¹ä½™é¢å¤±è´¥: ' + error.message);
      }
    }

    // åˆ é™¤ç”¨æˆ·
    async function deleteUser(username) {
      try {
        // ç¡®è®¤åˆ é™¤
        if (!confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· ${username} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
          return;
        }
        
        // è·å–token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        // å‘é€åˆ é™¤è¯·æ±‚
        const response = await fetch('/api/delete_user', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ username })
        });
        
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(data.error || 'åˆ é™¤ç”¨æˆ·å¤±è´¥');
        }
        
        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        const successMsg = document.getElementById('users-success');
        successMsg.textContent = data.message || 'ç”¨æˆ·åˆ é™¤æˆåŠŸ';
        successMsg.style.display = 'block';
        
        // é‡æ–°åŠ è½½ç”¨æˆ·åˆ—è¡¨
        setTimeout(() => {
          loadUsers();
          successMsg.style.display = 'none';
        }, 1500);
      } catch (error) {
        console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥:', error);
        const errorMsg = document.getElementById('users-error');
        errorMsg.textContent = 'åˆ é™¤ç”¨æˆ·å¤±è´¥: ' + error.message;
        errorMsg.style.display = 'block';
        
        // 3ç§’åéšè—é”™è¯¯æ¶ˆæ¯
        setTimeout(() => {
          errorMsg.style.display = 'none';
        }, 3000);
      }
    }

    // æ”¹å˜é¡µé¢
    function changePage(direction) {
      const newPage = currentRecordsPage + direction;
      if (newPage >= 1 && newPage <= totalRecordsPages) {
        loadGameRecords(newPage, currentRecordsLimit, currentRecordsUsername);
      }
    }

    // æ”¹å˜æ¯é¡µæ˜¾ç¤ºæ¡æ•°
    function changePageSize() {
      const pageSizeSelect = document.getElementById('page-size');
      const newLimit = parseInt(pageSizeSelect.value);
      loadGameRecords(1, newLimit, currentRecordsUsername); // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
    }

    // ç­›é€‰è®°å½•
    function filterRecords() {
      const usernameFilter = document.getElementById('username-filter').value.trim();
      loadGameRecords(1, currentRecordsLimit, usernameFilter); // é‡ç½®åˆ°ç¬¬ä¸€é¡µ
    }

    // æ¸…é™¤ç­›é€‰
    function clearFilter() {
      document.getElementById('username-filter').value = '';
      loadGameRecords(1, currentRecordsLimit, ''); // é‡ç½®åˆ°ç¬¬ä¸€é¡µï¼Œæ¸…é™¤ç­›é€‰
    }

    // ç™»å‡º
    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/login.html';
    }
  </script>
</body>
</html>