<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理员面板 - 喜从天降</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      background-color: #2196F3;
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    h1 {
      margin: 0;
      font-size: 24px;
    }
    .user-info {
      display: flex;
      align-items: center;
    }
    .user-info span {
      margin-right: 15px;
    }
    .btn {
      padding: 8px 16px;
      background-color: #1976D2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.3s;
    }
    .btn:hover {
      background-color: #0D47A1;
    }
    .btn-edit {
      background-color: #4CAF50;
    }
    .btn-edit:hover {
      background-color: #388E3C;
    }
    .btn-save {
      background-color: #FF9800;
    }
    .btn-save:hover {
      background-color: #F57C00;
    }
    .card {
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h2 {
      margin-top: 0;
      color: #2196F3;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
    }
    .stat-card {
      background-color: #f9f9f9;
      border-radius: 5px;
      padding: 15px;
      text-align: center;
    }
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #2196F3;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #666;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .win {
      color: #4CAF50;
    }
    .lose {
      color: #F44336;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    .error-message {
      color: #F44336;
      padding: 10px;
      background-color: #FFEBEE;
      border-radius: 4px;
      margin-bottom: 15px;
    }
    .success-message {
      color: #4CAF50;
      padding: 10px;
      background-color: #E8F5E9;
      border-radius: 4px;
      margin-bottom: 15px;
      display: none;
    }
    .balance-input {
      width: 100px;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    /* 模态框样式 */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      border-radius: 5px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .modal-header h3 {
      margin: 0;
      color: #2196F3;
    }
    .close-btn {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      color: #aaa;
    }
    .close-btn:hover {
      color: #333;
    }
    .modal-body {
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    .form-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .modal-footer {
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>🎮 喜从天降 - 管理员面板</h1>
      <div class="user-info">
        <span id="username">加载中...</span>
        <span id="balance">余额: 加载中...</span>
        <button class="btn" onclick="logout()">登出</button>
      </div>
    </header>
    
    <div class="card">
      <h2>📊 系统统计 - 总体数据</h2>
      <div id="stats-loading" class="loading">加载统计数据中...</div>
      <div id="stats-error" class="error-message" style="display: none;"></div>
      <div id="stats-container" class="stats-grid" style="display: none;">
        <div class="stat-card">
          <div class="stat-label">总游戏次数</div>
          <div id="total-games" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">总下注金额</div>
          <div id="total-bets" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">总派彩金额</div>
          <div id="total-payouts" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">庄家盈利</div>
          <div id="house-profit" class="stat-value">0</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>🎆 喜从天降游戏统计</h2>
      <div id="xctj-stats-container" class="stats-grid" style="display: none;">
        <div class="stat-card">
          <div class="stat-label">游戏次数</div>
          <div id="xctj-games" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">投注金额</div>
          <div id="xctj-bets" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">派彩金额</div>
          <div id="xctj-payouts" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">庄家盈利</div>
          <div id="xctj-profit" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">红桃次数</div>
          <div id="hearts-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">方块次数</div>
          <div id="diamonds-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">梅花次数</div>
          <div id="clubs-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">黑桃次数</div>
          <div id="spades-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">小丑次数</div>
          <div id="joker-count" class="stat-value">0</div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>🦁 飞禽走兽游戏统计</h2>
      <div id="animals-stats-container" class="stats-grid" style="display: none;">
        <div class="stat-card">
          <div class="stat-label">游戏次数</div>
          <div id="animals-games" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">投注金额</div>
          <div id="animals-bets" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">派彩金额</div>
          <div id="animals-payouts" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">庄家盈利</div>
          <div id="animals-profit" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">狮子 🦁</div>
          <div id="lion-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">熊猫 🐼</div>
          <div id="panda-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">老鹰 🦅</div>
          <div id="eagle-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">猴子 🐵</div>
          <div id="monkey-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">兔子 🐰</div>
          <div id="rabbit-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">孔雀 🦚</div>
          <div id="peacock-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">鸽子 🕊️</div>
          <div id="pigeon-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">燕子 🐦</div>
          <div id="swallow-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">金鲨 🦈</div>
          <div id="gold-shark-count" class="stat-value">0</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">银鲨 🦈</div>
          <div id="silver-shark-count" class="stat-value">0</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <h2>用户列表</h2>
      <div id="users-loading" class="loading">加载用户数据中...</div>
      <div id="users-error" class="error-message" style="display: none;"></div>
      <div id="users-success" class="success-message" style="display: none;"></div>
      <div id="users-container" style="display: none;">
        <table id="users-table">
          <thead>
            <tr>
              <th>用户名</th>
              <th>余额</th>
              <th>角色</th>
              <th>创建时间</th>
              <th>最后登录</th>
              <th>操作</th>
            </tr>
          </thead>
          <tbody id="users-tbody">
            <!-- 用户数据将在这里动态加载 -->
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="card">
      <h2>游戏记录</h2>
      <div id="records-loading" class="loading">加载游戏记录中...</div>
      <div id="records-error" class="error-message" style="display: none;"></div>
      <div id="records-container" style="display: none;">
        <table id="records-table">
          <thead>
            <tr>
              <th>用户</th>
              <th>游戏类型</th>
              <th>下注内容</th>
              <th>结果</th>
              <th>下注金额</th>
              <th>输赢</th>
              <th>赢取金额</th>
              <th>时间</th>
            </tr>
          </thead>
          <tbody id="records-tbody">
            <!-- 游戏记录将在这里动态加载 -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 修改余额模态框 -->
  <div id="edit-balance-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>修改用户余额</h3>
        <span class="close-btn" onclick="closeModal()">&times;</span>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label>用户名:</label>
          <input type="text" id="modal-username" readonly>
        </div>
        <div class="form-group">
          <label>当前余额:</label>
          <input type="text" id="modal-current-balance" readonly>
        </div>
        <div class="form-group">
          <label>新余额:</label>
          <input type="number" id="modal-new-balance" min="0" step="100">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" onclick="closeModal()">取消</button>
        <button class="btn btn-save" onclick="saveBalance()">保存</button>
      </div>
    </div>
  </div>

  <script>
    // 全局变量
    let currentUsers = [];
    let editingUserId = null;

    // 页面加载时检查登录状态并加载数据
    window.addEventListener('load', async () => {
      try {
        // 获取token
        const token = localStorage.getItem('token');
        if (!token) {
          // 未登录，重定向到登录页面
          window.location.href = '/login.html';
          return;
        }
        
        // 检查登录状态
        const userResponse = await fetch('/api/user', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!userResponse.ok) {
          // 未登录或token无效，重定向到登录页面
          localStorage.removeItem('token');
          window.location.href = '/login.html';
          return;
        }
        
        const userData = await userResponse.json();
        
        // 检查是否为管理员
        if (!userData.is_admin) {
          // 不是管理员，重定向到游戏页面
          window.location.href = '/game.html';
          return;
        }
        
        // 显示用户信息
        document.getElementById('username').textContent = userData.username;
        document.getElementById('balance').textContent = `余额: ${userData.balance}`;
        
        // 加载统计数据
        loadStats();
        
        // 加载用户列表
        loadUsers();
        
        // 加载游戏记录
        loadGameRecords();
      } catch (error) {
        console.error('初始化失败:', error);
        alert('加载数据失败，请刷新页面重试');
      }
    });

    // 加载统计数据
    async function loadStats() {
      try {
        // 获取token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        const response = await fetch('/api/house_stats', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
            return;
          }
          throw new Error('获取统计数据失败');
        }
        
        const data = await response.json();
        
        if (!data.success || !data.stats) {
          throw new Error('统计数据格式错误');
        }
        
        const stats = data.stats;
        
        // 显示总体统计数据
        document.getElementById('total-games').textContent = stats.totalGames;
        document.getElementById('total-bets').textContent = stats.totalBets;
        document.getElementById('total-payouts').textContent = stats.totalPayouts;
        document.getElementById('house-profit').textContent = stats.houseProfit;
        
        // 显示喜从天降游戏统计
        document.getElementById('xctj-games').textContent = stats.xctjStats.totalGames;
        document.getElementById('xctj-bets').textContent = stats.xctjStats.totalBets;
        document.getElementById('xctj-payouts').textContent = stats.xctjStats.totalPayouts;
        document.getElementById('xctj-profit').textContent = stats.xctjStats.houseProfit;
        document.getElementById('hearts-count').textContent = stats.xctjStats.heartsCount;
        document.getElementById('diamonds-count').textContent = stats.xctjStats.diamondsCount;
        document.getElementById('clubs-count').textContent = stats.xctjStats.clubsCount;
        document.getElementById('spades-count').textContent = stats.xctjStats.spadesCount;
        document.getElementById('joker-count').textContent = stats.xctjStats.jokerCount;
        
        // 显示飞禽走兽游戏统计
        document.getElementById('animals-games').textContent = stats.animalsStats.totalGames;
        document.getElementById('animals-bets').textContent = stats.animalsStats.totalBets;
        document.getElementById('animals-payouts').textContent = stats.animalsStats.totalPayouts;
        document.getElementById('animals-profit').textContent = stats.animalsStats.houseProfit;
        document.getElementById('lion-count').textContent = stats.animalsStats.lionCount;
        document.getElementById('panda-count').textContent = stats.animalsStats.pandaCount;
        document.getElementById('eagle-count').textContent = stats.animalsStats.eagleCount;
        document.getElementById('monkey-count').textContent = stats.animalsStats.monkeyCount;
        document.getElementById('rabbit-count').textContent = stats.animalsStats.rabbitCount;
        document.getElementById('peacock-count').textContent = stats.animalsStats.peacockCount;
        document.getElementById('pigeon-count').textContent = stats.animalsStats.pigeonCount;
        document.getElementById('swallow-count').textContent = stats.animalsStats.swallowCount;
        document.getElementById('gold-shark-count').textContent = stats.animalsStats.goldSharkCount;
        document.getElementById('silver-shark-count').textContent = stats.animalsStats.silverSharkCount;
        
        // 隐藏加载提示，显示统计数据
        document.getElementById('stats-loading').style.display = 'none';
        document.getElementById('stats-container').style.display = 'grid';
        document.getElementById('xctj-stats-container').style.display = 'grid';
        document.getElementById('animals-stats-container').style.display = 'grid';
      } catch (error) {
        console.error('加载统计数据失败:', error);
        document.getElementById('stats-loading').style.display = 'none';
        document.getElementById('stats-error').textContent = '加载统计数据失败: ' + error.message;
        document.getElementById('stats-error').style.display = 'block';
      }
    }

    // 加载用户列表
    async function loadUsers() {
      try {
        // 获取token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        const response = await fetch('/api/admin/users', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
            return;
          }
          throw new Error('获取用户列表失败');
        }
        
        const data = await response.json();
        
        if (!data.success || !data.users) {
          throw new Error('用户数据格式错误');
        }
        
        // 保存用户数据到全局变量
        currentUsers = data.users;
        
        // 清空表格
        const tbody = document.getElementById('users-tbody');
        tbody.innerHTML = '';
        
        // 添加用户数据
        data.users.forEach(user => {
          const tr = document.createElement('tr');
          
          // 格式化日期
          const createdAt = user.created_at ? new Date(user.created_at).toLocaleString() : '未知';
          const lastLogin = user.last_login ? new Date(user.last_login).toLocaleString() : '未知';
          
          tr.innerHTML = `
            <td>${user.username}</td>
            <td>${user.balance}</td>
            <td>${user.is_admin ? '管理员' : '普通用户'}</td>
            <td>${createdAt}</td>
            <td>${lastLogin}</td>
            <td>
              <button class="btn btn-edit" onclick="openEditBalanceModal('${user._id}')">修改余额</button>
            </td>
          `;
          
          tbody.appendChild(tr);
        });
        
        // 隐藏加载提示，显示用户列表
        document.getElementById('users-loading').style.display = 'none';
        document.getElementById('users-container').style.display = 'block';
      } catch (error) {
        console.error('加载用户列表失败:', error);
        document.getElementById('users-loading').style.display = 'none';
        document.getElementById('users-error').textContent = '加载用户列表失败: ' + error.message;
        document.getElementById('users-error').style.display = 'block';
      }
    }

    // 加载游戏记录
    async function loadGameRecords() {
      try {
        // 获取token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        const response = await fetch('/api/game_records', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (!response.ok) {
          if (response.status === 401) {
            localStorage.removeItem('token');
            window.location.href = '/login.html';
            return;
          }
          throw new Error('获取游戏记录失败');
        }
        
        const data = await response.json();
        
        if (!data.success || !data.records) {
          throw new Error('游戏记录格式错误');
        }
        
        // 清空表格
        const tbody = document.getElementById('records-tbody');
        tbody.innerHTML = '';
        
        // 添加游戏记录
        data.records.forEach(record => {
          const tr = document.createElement('tr');
          
          // 格式化日期
          const createdAt = record.created_at ? new Date(record.created_at).toLocaleString() : '未知';
          
          // 决定游戏类型
          const gameType = record.game_type === 'animals' ? '🦁 飞禽走兽' : '🎆 喜从天降';
          
          // 翻译花色/动物
          const translateResult = (type, result) => {
            if (type === 'animals') {
              const animalNames = {
                'lion': '狮子 🦁',
                'panda': '熊猫 🐼',
                'eagle': '老鹰 🦅',
                'monkey': '猴子 🐵',
                'rabbit': '兔子 🐰',
                'peacock': '孔雀 🦚',
                'pigeon': '鸽子 🕊️',
                'swallow': '燕子 🐦',
                'gold_shark': '金鲨 🦈',
                'silver_shark': '银鲨 🦈'
              };
              return animalNames[result] || result;
            } else {
              const suitNames = {
                'hearts': '红桃 ♥',
                'diamonds': '方块 ♦',
                'clubs': '梅花 ♣',
                'spades': '黑桃 ♠',
                'joker': '小丑 🃏'
              };
              return suitNames[result] || result;
            }
          };
          
          // 解析下注内容
          let betDisplay = '';
          if (record.game_type === 'animals') {
            // 飞禽走兽游戏
            try {
              if (record.bet_data && record.bet_data.startsWith('{')) {
                const bets = JSON.parse(record.bet_data);
                const betEntries = Object.entries(bets)
                  .filter(([_, amount]) => amount > 0)
                  .map(([animal, amount]) => `${translateResult('animals', animal)}:${amount}`)
                  .join(', ');
                betDisplay = betEntries || '未知';
              } else {
                betDisplay = '未知';
              }
            } catch (e) {
              betDisplay = '解析错误';
            }
          } else {
            // 喜从天降游戏
            try {
              if (record.bet_suit && record.bet_suit.startsWith('{')) {
                const bets = JSON.parse(record.bet_suit);
                const betEntries = Object.entries(bets)
                  .filter(([_, amount]) => amount > 0)
                  .map(([suit, amount]) => `${translateResult('xctj', suit)}:${amount}`)
                  .join(', ');
                betDisplay = betEntries || translateResult('xctj', record.bet_suit);
              } else {
                betDisplay = translateResult('xctj', record.bet_suit);
              }
            } catch (e) {
              betDisplay = translateResult('xctj', record.bet_suit);
            }
          }
          
          // 获取结果
          const resultDisplay = record.game_type === 'animals' ? 
            translateResult('animals', record.result_animal) : 
            translateResult('xctj', record.result_suit);
          
          // 计算输赢状态
          const netResult = (record.win_amount || 0) - (record.amount || 0);
          const isWin = netResult > 0;
          const winLoseText = isWin ? `赢 ${netResult}` : `输 ${Math.abs(netResult)}`;
          
          tr.innerHTML = `
            <td>${record.username}</td>
            <td>${gameType}</td>
            <td>${betDisplay}</td>
            <td>${resultDisplay}</td>
            <td>${record.amount}</td>
            <td class="${isWin ? 'win' : 'lose'}">${winLoseText}</td>
            <td>${record.win_amount}</td>
            <td>${createdAt}</td>
          `;
          
          tbody.appendChild(tr);
        });
        
        // 隐藏加载提示，显示游戏记录
        document.getElementById('records-loading').style.display = 'none';
        document.getElementById('records-container').style.display = 'block';
      } catch (error) {
        console.error('加载游戏记录失败:', error);
        document.getElementById('records-loading').style.display = 'none';
        document.getElementById('records-error').textContent = '加载游戏记录失败: ' + error.message;
        document.getElementById('records-error').style.display = 'block';
      }
    }

    // 打开修改余额模态框
    function openEditBalanceModal(userId) {
      // 查找用户
      const user = currentUsers.find(u => u._id === userId);
      if (!user) {
        alert('找不到用户信息');
        return;
      }
      
      // 设置模态框数据
      document.getElementById('modal-username').value = user.username;
      document.getElementById('modal-current-balance').value = user.balance;
      document.getElementById('modal-new-balance').value = user.balance;
      
      // 保存当前编辑的用户ID
      editingUserId = userId;
      
      // 显示模态框
      document.getElementById('edit-balance-modal').style.display = 'block';
    }

    // 关闭模态框
    function closeModal() {
      document.getElementById('edit-balance-modal').style.display = 'none';
      editingUserId = null;
    }

    // 保存余额修改
    async function saveBalance() {
      try {
        const newBalance = parseInt(document.getElementById('modal-new-balance').value);
        
        // 验证输入
        if (isNaN(newBalance) || newBalance < 0) {
          alert('请输入有效的余额');
          return;
        }
        
        // 获取token
        const token = localStorage.getItem('token');
        if (!token) {
          window.location.href = '/login.html';
          return;
        }
        
        // 发送请求
        const response = await fetch('/api/update_balance', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({
            username: document.getElementById('modal-username').value,
            balance: newBalance
          })
        });
        
        if (!response.ok) {
          const data = await response.json();
          throw new Error(data.error || '修改余额失败');
        }
        
        // 关闭模态框
        closeModal();
        
        // 显示成功消息
        const successMsg = document.getElementById('users-success');
        successMsg.textContent = '余额修改成功';
        successMsg.style.display = 'block';
        
        // 3秒后隐藏成功消息
        setTimeout(() => {
          successMsg.style.display = 'none';
        }, 3000);
        
        // 重新加载用户列表
        loadUsers();
      } catch (error) {
        console.error('修改余额失败:', error);
        alert('修改余额失败: ' + error.message);
      }
    }

    // 登出
    function logout() {
      // 清除token
      localStorage.removeItem('token');
      // 重定向到登录页面
      window.location.href = '/login.html';
    }

    // 点击模态框外部关闭模态框
    window.onclick = function(event) {
      const modal = document.getElementById('edit-balance-modal');
      if (event.target === modal) {
        closeModal();
      }
    }
  </script>
</body>
</html>