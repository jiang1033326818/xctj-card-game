<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>卡牌游戏</title>
  <style>
    body {
      font-family: 'Microsoft YaHei', Arial, sans-serif;
      background-color: #121212;
      margin: 0;
      padding: 0;
      color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
    }
    h1 {
      margin: 0;
      color: #ff9800;
      text-shadow: 0 0 10px rgba(255, 152, 0, 0.5);
      font-size: 2.5rem;
    }
    .user-info {
      display: flex;
      align-items: center;
    }
    .balance {
      margin-right: 20px;
      font-weight: bold;
      font-size: 1.2rem;
      color: #4caf50;
    }
    .logout-btn {
      padding: 10px 20px;
      background-color: #f44336;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .logout-btn:hover {
      background-color: #d32f2f;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    .main-content {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
    }
    .game-area {
      flex: 1;
      min-width: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      background-color: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      padding: 30px;
      margin-bottom: 30px;
      border: 1px solid #333;
    }
    .card-container {
      perspective: 1000px;
      margin-bottom: 30px;
    }
    .card-display {
      width: 220px;
      height: 320px;
      position: relative;
      transition: transform 1.5s;
      transform-style: preserve-3d;
      cursor: pointer;
    }
    .card-display.flipped {
      transform: rotateY(1080deg); /* 多转几圈 */
    }
    .card-front, .card-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      border-radius: 15px;
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    .card-front {
      background: linear-gradient(135deg, #2c3e50, #1a1a2e);
      border: 2px solid #444;
      color: #ddd;
      font-size: 36px;
      transform: rotateY(180deg);
    }
    .card-back {
      background: linear-gradient(135deg, #4a148c, #311b92);
      border: 2px solid #673ab7;
      z-index: 2;
    }
    .card-pattern {
      width: 80%;
      height: 80%;
      background-image: repeating-linear-gradient(
        45deg,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0.1) 10px,
        transparent 10px,
        transparent 20px
      );
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .card-logo {
      font-size: 40px;
      color: rgba(255, 255, 255, 0.7);
    }
    .card-front.hearts, .card-front.diamonds {
      color: #ff5252;
      background: linear-gradient(135deg, #1a1a2e, #0a0a1a);
      border-color: #ff5252;
    }
    .card-front.clubs, .card-front.spades {
      color: #e0e0e0;
      background: linear-gradient(135deg, #1a1a2e, #0a0a1a);
      border-color: #e0e0e0;
    }
    .card-front.joker {
      color: #ff9800;
      background: linear-gradient(135deg, #1a1a2e, #0a0a1a);
      border-color: #ff9800;
    }
    .card-symbol {
      font-size: 120px;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    .status-message {
      margin-top: 15px;
      text-align: center;
      font-size: 18px;
      padding: 10px;
      border-radius: 5px;
      width: 100%;
    }
    .status-message.win {
      color: #4CAF50;
    }
    .status-message.lose {
      color: #f44336;
    }
    .result-display {
      margin-top: 15px;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      display: none;
      width: 100%;
      box-sizing: border-box;
    }
    .result-display.win {
      background-color: rgba(76, 175, 80, 0.2);
      color: #4CAF50;
      border: 1px solid #2E7D32;
    }
    .result-display.lose {
      background-color: rgba(244, 67, 54, 0.2);
      color: #f44336;
      border: 1px solid #c62828;
    }
    .bet-area {
      flex: 1;
      min-width: 300px;
      background-color: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      padding: 20px;
      border: 1px solid #333;
    }
    .bet-area h2 {
      margin-top: 0;
      margin-bottom: 20px;
      color: #ff9800;
      text-shadow: 0 0 5px rgba(255, 152, 0, 0.3);
    }
    .suit-options {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    .suit-option {
      position: relative;
      padding: 15px;
      border: 2px solid #444;
      border-radius: 8px;
      background-color: #2a2a2a;
      cursor: pointer;
      text-align: center;
      transition: all 0.3s;
    }
    .suit-option:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
    }
    .suit-option.selected {
      border-color: #2196F3;
      background-color: rgba(33, 150, 243, 0.2);
      box-shadow: 0 0 15px rgba(33, 150, 243, 0.5);
    }
    .suit-option.hearts, .suit-option.diamonds {
      color: #ff5252;
    }
    .suit-option.clubs, .suit-option.spades {
      color: #e0e0e0;
    }
    .suit-option.joker {
      color: #ff9800;
    }
    .suit-symbol {
      font-size: 36px;
      margin-bottom: 5px;
    }
    .suit-name {
      font-size: 14px;
    }
    .odds-info {
      font-size: 12px;
      color: #888;
      margin-top: 5px;
    }
    .bet-amount {
      position: absolute;
      top: -10px;
      right: -10px;
      background-color: #2196F3;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .suit-option.has-bet .bet-amount {
      opacity: 1;
    }
    .chip-options {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 25px;
    }
    .chip {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.3s;
      border: 3px solid rgba(255, 255, 255, 0.2);
    }
    .chip:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
    }
    .chip.selected {
      border-color: #fff;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
    }
    .chip-1 {
      background: linear-gradient(135deg, #90CAF9, #2196F3);
      color: white;
    }
    .chip-5 {
      background: linear-gradient(135deg, #80CBC4, #009688);
      color: white;
    }
    .chip-10 {
      background: linear-gradient(135deg, #FFD54F, #FFC107);
      color: #333;
    }
    .chip-50 {
      background: linear-gradient(135deg, #E57373, #F44336);
      color: white;
    }
    .chip-100 {
      background: linear-gradient(135deg, #9575CD, #673AB7);
      color: white;
    }
    .total-bet {
      text-align: center;
      margin-bottom: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    .play-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
    }
    .play-btn:hover {
      background: linear-gradient(135deg, #43A047, #2E7D32);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
      transform: translateY(-2px);
    }
    .play-btn:disabled {
      background: linear-gradient(135deg, #9E9E9E, #757575);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .history-area {
      flex: 1;
      min-width: 300px;
      max-height: 600px;
      overflow-y: auto;
      background-color: #1e1e1e;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
      padding: 20px;
      border: 1px solid #333;
    }
    .history-area h2 {
      margin-top: 0;
      margin-bottom: 20px;
      color: #ff9800;
      text-shadow: 0 0 5px rgba(255, 152, 0, 0.3);
    }
    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .history-item {
      padding: 15px;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
    }
    .history-item:last-child {
      border-bottom: none;
    }
    .history-suit-icon {
      font-size: 30px;
      margin-right: 15px;
      width: 40px;
      text-align: center;
    }
    .history-details {
      flex: 1;
    }
    .history-time {
      font-size: 12px;
      color: #888;
      margin-bottom: 5px;
    }
    .history-result {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .history-bet {
      font-size: 14px;
    }
    .history-win {
      color: #4CAF50;
      font-weight: bold;
    }
    .history-lose {
      color: #f44336;
      font-weight: bold;
    }
    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-left-color: #ff9800;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      display: inline-block;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .pagination {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      gap: 10px;
    }
    .pagination button {
      padding: 8px 15px;
      background-color: #2a2a2a;
      color: #ddd;
      border: 1px solid #444;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .pagination button:hover:not(:disabled) {
      background-color: #333;
      border-color: #666;
    }
    .pagination button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .pagination button.active {
      background-color: #2196F3;
      color: white;
      border-color: #1976D2;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>卡牌游戏</h1>
      <div class="user-info">
        <div class="balance">余额: <span id="balance">0</span></div>
        <button id="logout-btn" class="logout-btn">退出登录</button>
      </div>
    </header>

    <div class="main-content">
      <div class="game-area">
        <div class="card-container">
          <div id="card-display" class="card-display">
            <div class="card-front">
              <span id="card-symbol" class="card-symbol">?</span>
            </div>
            <div class="card-back">
              <div class="card-pattern">
                <div class="card-logo">♠♥♦♣</div>
              </div>
            </div>
          </div>
        </div>
        <div id="status-message" class="status-message">选择筹码和花色，点击开始游戏</div>
        <div id="result-display" class="result-display"></div>
      </div>

      <div class="bet-area">
        <h2>选择下注</h2>
        <div class="suit-options">
          <div class="suit-option hearts" data-suit="hearts">
            <div class="bet-amount">0</div>
            <div class="suit-symbol">♥</div>
            <div class="suit-name">红桃</div>
            <div class="odds-info">赔率 x3.5</div>
          </div>
          <div class="suit-option diamonds" data-suit="diamonds">
            <div class="bet-amount">0</div>
            <div class="suit-symbol">♦</div>
            <div class="suit-name">方块</div>
            <div class="odds-info">赔率 x3.6</div>
          </div>
          <div class="suit-option clubs" data-suit="clubs">
            <div class="bet-amount">0</div>
            <div class="suit-symbol">♣</div>
            <div class="suit-name">梅花</div>
            <div class="odds-info">赔率 x3.7</div>
          </div>
          <div class="suit-option spades" data-suit="spades">
            <div class="bet-amount">0</div>
            <div class="suit-symbol">♠</div>
            <div class="suit-name">黑桃</div>
            <div class="odds-info">赔率 x3.8</div>
          </div>
          <div class="suit-option joker" data-suit="joker">
            <div class="bet-amount">0</div>
            <div class="suit-symbol">🃏</div>
            <div class="suit-name">小丑</div>
            <div class="odds-info">赔率 x100</div>
          </div>
        </div>

        <div class="chip-options">
          <div class="chip chip-1" data-value="1">1</div>
          <div class="chip chip-5" data-value="5">5</div>
          <div class="chip chip-10 selected" data-value="10">10</div>
          <div class="chip chip-50" data-value="50">50</div>
          <div class="chip chip-100" data-value="100">100</div>
        </div>

        <div class="total-bet">总下注: <span id="total-bet">0</span></div>
        <button id="play-btn" class="play-btn" disabled>开始游戏</button>
      </div>

      <div class="history-area">
        <h2>游戏历史</h2>
        <div id="loading" class="loading">
          <div class="spinner"></div>
          <p>加载中...</p>
        </div>
        <ul id="history-list" class="history-list">
          <!-- 历史记录将在这里动态添加 -->
        </ul>
        <div id="pagination" class="pagination">
          <!-- 分页控件将在这里动态添加 -->
        </div>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // 元素引用
      const balanceEl = document.getElementById('balance');
      const logoutBtn = document.getElementById('logout-btn');
      const cardDisplay = document.getElementById('card-display');
      const cardSymbol = document.getElementById('card-symbol');
      const statusMessage = document.getElementById('status-message');
      const resultDisplay = document.getElementById('result-display');
      const suitOptions = document.querySelectorAll('.suit-option');
      const chipOptions = document.querySelectorAll('.chip');
      const totalBetEl = document.getElementById('total-bet');
      const playBtn = document.getElementById('play-btn');
      const historyList = document.getElementById('history-list');
      const loadingEl = document.getElementById('loading');
      const paginationEl = document.getElementById('pagination');

      // 花色符号和名称
      const suitSymbols = {
        'hearts': '♥',
        'diamonds': '♦',
        'clubs': '♣',
        'spades': '♠',
        'joker': '🃏'
      };
      
      const suitNames = {
        'hearts': '红桃',
        'diamonds': '方块',
        'clubs': '梅花',
        'spades': '黑桃',
        'joker': '小丑'
      };

      // 状态变量
      let userBalance = 0;
      let currentChipValue = 10; // 默认筹码值
      let currentBets = {
        'hearts': 0,
        'diamonds': 0,
        'clubs': 0,
        'spades': 0,
        'joker': 0
      };
      let totalBet = 0;
      let isPlaying = false;
      let currentPage = 1;
      let totalPages = 1;
      let pageSize = 8;
      let allRecords = [];

      // 从localStorage加载筹码选择
      const savedChipValue = localStorage.getItem('selectedChipValue');
      if (savedChipValue) {
        currentChipValue = parseInt(savedChipValue);
        chipOptions.forEach(chip => {
          chip.classList.remove('selected');
          if (parseInt(chip.dataset.value) === currentChipValue) {
            chip.classList.add('selected');
          }
        });
      }

      // 初始化
      checkAuth();
      loadHistory();

      // 检查用户是否已登录
      async function checkAuth() {
        try {
          const response = await fetch('/api/user');
          if (!response.ok) {
            // 未登录，重定向到登录页面
            window.location.href = '/login.html';
            return;
          }

          const data = await response.json();
          if (data.is_admin) {
            // 管理员用户，重定向到管理页面
            window.location.href = '/admin.html';
            return;
          }

          // 更新用户余额
          userBalance = data.balance;
          balanceEl.textContent = userBalance;
        } catch (error) {
          console.error('检查认证失败:', error);
          window.location.href = '/login.html';
        }
      }

      // 加载游戏历史
      async function loadHistory() {
        try {
          loadingEl.style.display = 'block';
          historyList.style.display = 'none';
          paginationEl.style.display = 'none';
          
          const response = await fetch('/api/game_records');
          
          if (!response.ok) {
            throw new Error('加载历史记录失败');
          }

          const data = await response.json();
          allRecords = data.records || [];
          totalPages = Math.ceil(allRecords.length / pageSize);
          renderHistory();
          renderPagination();
        } catch (error) {
          console.error('加载历史记录错误:', error);
        } finally {
          loadingEl.style.display = 'none';
          historyList.style.display = 'block';
          paginationEl.style.display = 'flex';
        }
      }

      // 渲染历史记录
      function renderHistory() {
        historyList.innerHTML = '';
        
        if (!allRecords || allRecords.length === 0) {
          const emptyItem = document.createElement('li');
          emptyItem.className = 'history-item';
          emptyItem.textContent = '暂无游戏记录';
          historyList.appendChild(emptyItem);
          return;
        }

        // 计算当前页的记录
        const startIndex = (currentPage - 1) * pageSize;
        const endIndex = Math.min(startIndex + pageSize, allRecords.length);
        const currentRecords = allRecords.slice(startIndex, endIndex);

        currentRecords.forEach(record => {
          const item = document.createElement('li');
          item.className = 'history-item';
          
          // 格式化时间
          const date = new Date(record.created_at);
          const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
          
          // 花色颜色
          const suitColors = {
            'hearts': '#ff5252',
            'diamonds': '#ff5252',
            'clubs': '#e0e0e0',
            'spades': '#e0e0e0',
            'joker': '#ff9800'
          };
          
          // 结果类名
          const resultClass = record.win_amount > 0 ? 'history-win' : 'history-lose';
          const resultText = record.win_amount > 0 ? `赢 +${record.win_amount}` : `输 -${record.amount}`;
          
          item.innerHTML = `
            <div class="history-suit-icon" style="color: ${suitColors[record.result_suit]}">${suitSymbols[record.result_suit]}</div>
            <div class="history-details">
              <div class="history-time">${formattedDate}</div>
              <div class="history-result">
                <div class="history-bet">下注: ${record.bet_suit.split(',').map(suit => suitNames[suit]).join(', ')} (${record.amount})</div>
                <div class="${resultClass}">${resultText}</div>
              </div>
            </div>
          `;
          
          historyList.appendChild(item);
        });
      }

      // 渲染分页
      function renderPagination() {
        paginationEl.innerHTML = '';
        
        if (totalPages <= 1) {
          return;
        }
        
        // 上一页按钮
        const prevBtn = document.createElement('button');
        prevBtn.textContent = '上一页';
        prevBtn.disabled = currentPage === 1;
        prevBtn.addEventListener('click', () => {
          if (currentPage > 1) {
            currentPage--;
            renderHistory();
            renderPagination();
          }
        });
        paginationEl.appendChild(prevBtn);
        
        // 页码按钮
        const maxButtons = 5;
        const startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
        const endPage = Math.min(totalPages, startPage + maxButtons - 1);
        
        for (let i = startPage; i <= endPage; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.textContent = i;
          pageBtn.className = i === currentPage ? 'active' : '';
          pageBtn.addEventListener('click', () => {
            currentPage = i;
            renderHistory();
            renderPagination();
          });
          paginationEl.appendChild(pageBtn);
        }
        
        // 下一页按钮
        const nextBtn = document.createElement('button');
        nextBtn.textContent = '下一页';
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.addEventListener('click', () => {
          if (currentPage < totalPages) {
            currentPage++;
            renderHistory();
            renderPagination();
          }
        });
        paginationEl.appendChild(nextBtn);
      }

      // 筹码选择事件
      chipOptions.forEach(chip => {
        chip.addEventListener('click', function() {
          chipOptions.forEach(c => c.classList.remove('selected'));
          this.classList.add('selected');
          currentChipValue = parseInt(this.dataset.value);
          localStorage.setItem('selectedChipValue', currentChipValue);
        });
      });

      // 花色选择事件
      suitOptions.forEach(option => {
        option.addEventListener('click', function() {
          const suit = this.dataset.suit;
          
          // 添加当前筹码值到下注
          currentBets[suit] += currentChipValue;
          
          // 更新下注显示
          this.querySelector('.bet-amount').textContent = currentBets[suit];
          this.classList.add('has-bet');
          
          // 更新总下注
          updateTotalBet();
        });
      });

      // 更新总下注
      function updateTotalBet() {
        totalBet = Object.values(currentBets).reduce((sum, bet) => sum + bet, 0);
        totalBetEl.textContent = totalBet;
        
        // 启用/禁用开始按钮
        playBtn.disabled = totalBet === 0 || isPlaying || totalBet > userBalance;
      }

      // 重置下注
      function resetBets() {
        Object.keys(currentBets).forEach(suit => {
          currentBets[suit] = 0;
        });
        
        suitOptions.forEach(option => {
          option.querySelector('.bet-amount').textContent = '0';
          option.classList.remove('has-bet');
        });
        
        totalBet = 0;
        totalBetEl.textContent = '0';
        playBtn.disabled = true;
      }

      // 开始游戏
      playBtn.addEventListener('click', startGame);

      async function startGame() {
        if (isPlaying || totalBet === 0) return;
        
        isPlaying = true;
        playBtn.disabled = true;
        resultDisplay.style.display = 'none';
        statusMessage.textContent = '游戏进行中...';
        statusMessage.className = 'status-message';
        
        try {
          // 准备下注数据
          const betData = {
            bet_suit: Object.keys(currentBets).filter(suit => currentBets[suit] > 0).join(','),
            amount: totalBet
          };
          
          // 发送游戏请求
          const response = await fetch('/api/game', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${localStorage.getItem('token')}`
            },
            body: JSON.stringify(betData)
          });
          
          if (!response.ok) {
            throw new Error('游戏请求失败');
          }
          
          const result = await response.json();
          
          // 翻转卡牌
          flipCard(result.result_suit);
          
          // 更新余额
          userBalance = result.new_balance;
          balanceEl.textContent = userBalance;
          
          // 3秒后显示结果
          setTimeout(() => {
            showResult(result);
            
            // 重新加载历史记录
            loadHistory();
            
            // 重置游戏状态
            setTimeout(() => {
              resetGameState();
            }, 2000);
          }, 3000);
          
        } catch (error) {
          console.error('游戏错误:', error);
          statusMessage.textContent = '游戏出错，请重试';
          statusMessage.className = 'status-message lose';
          isPlaying = false;
          playBtn.disabled = false;
        }
      }

      // 翻转卡牌
      function flipCard(resultSuit) {
        // 设置卡牌正面的花色
        cardSymbol.textContent = suitSymbols[resultSuit];
        cardDisplay.querySelector('.card-front').className = `card-front ${resultSuit}`;
        
        // 翻转卡牌
        cardDisplay.classList.add('flipped');
      }

      // 显示游戏结果
      function showResult(result) {
        const isWin = result.win_amount > 0;
        
        // 更新状态消息
        if (isWin) {
          statusMessage.textContent = `恭喜！您赢得了 ${result.win_amount} 金币`;
          statusMessage.className = 'status-message win';
          
          resultDisplay.textContent = `抽到了 ${suitNames[result.result_suit]}，您赢得了 ${result.win_amount} 金币！`;
          resultDisplay.className = 'result-display win';
        } else {
          statusMessage.textContent = `很遗憾，您输了 ${totalBet} 金币`;
          statusMessage.className = 'status-message lose';
          
          resultDisplay.textContent = `抽到了 ${suitNames[result.result_suit]}，您输了 ${totalBet} 金币。`;
          resultDisplay.className = 'result-display lose';
        }
        
        resultDisplay.style.display = 'block';
      }

      // 重置游戏状态
      function resetGameState() {
        cardDisplay.classList.remove('flipped');
        isPlaying = false;
        resetBets();
        statusMessage.textContent = '选择筹码和花色，点击开始游戏';
        statusMessage.className = 'status-message';
        playBtn.disabled = totalBet === 0;
      }

      // 退出登录
      logoutBtn.addEventListener('click', function() {
        localStorage.removeItem('token');
        window.location.href = '/login.html';
      });
    });
  </script>
</body>
</html>