<!DOCTYPE html>
<html>
<head>
  <title>测试400错误</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    button { margin: 5px; padding: 5px 10px; }
    pre { background: #f0f0f0; padding: 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>测试400错误</h1>
  
  <h2>测试1: 直接使用fetch</h2>
  <button onclick="testFetch()">测试Fetch</button>
  
  <h2>测试2: 使用XMLHttpRequest</h2>
  <button onclick="testXHR()">测试XHR</button>
  
  <h2>测试3: 使用表单提交</h2>
  <form id="loginForm">
    <input type="text" id="username" value="admin" placeholder="用户名">
    <input type="password" id="password" value="068162" placeholder="密码">
    <button type="submit">登录</button>
  </form>
  
  <h2>测试4: 使用最简单的请求</h2>
  <button onclick="testSimple()">最简单测试</button>
  
  <h2>结果:</h2>
  <pre id="result">点击按钮开始测试...</pre>
  
  <script>
    // 测试1: 使用fetch
    function testFetch() {
      document.getElementById('result').textContent = '正在使用fetch测试...';
      
      fetch('/api/minimal-login-raw', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: 'admin',
          password: '068162'
        })
      })
      .then(response => {
        return response.text().then(text => {
          document.getElementById('result').textContent = 
            'Status: ' + response.status + '\n' +
            'Response: ' + text;
        });
      })
      .catch(error => {
        document.getElementById('result').textContent = '请求失败: ' + error;
      });
    }
    
    // 测试2: 使用XMLHttpRequest
    function testXHR() {
      document.getElementById('result').textContent = '正在使用XHR测试...';
      
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/api/minimal-login-raw', true);
      xhr.setRequestHeader('Content-Type', 'application/json');
      
      xhr.onload = function() {
        document.getElementById('result').textContent = 
          'Status: ' + xhr.status + '\n' +
          'Response: ' + xhr.responseText;
      };
      
      xhr.onerror = function() {
        document.getElementById('result').textContent = '请求失败';
      };
      
      xhr.send(JSON.stringify({
        username: 'admin',
        password: '068162'
      }));
    }
    
    // 测试3: 使用表单提交
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      document.getElementById('result').textContent = '正在使用表单提交测试...';
      
      var formData = new FormData();
      formData.append('username', document.getElementById('username').value);
      formData.append('password', document.getElementById('password').value);
      
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/api/minimal-login-raw', true);
      
      xhr.onload = function() {
        document.getElementById('result').textContent = 
          'Status: ' + xhr.status + '\n' +
          'Response: ' + xhr.responseText;
      };
      
      xhr.onerror = function() {
        document.getElementById('result').textContent = '请求失败';
      };
      
      xhr.send(formData);
    });
    
    // 测试4: 使用最简单的请求
    function testSimple() {
      document.getElementById('result').textContent = '正在使用最简单请求测试...';
      
      var xhr = new XMLHttpRequest();
      xhr.open('POST', '/api/echo', true);
      
      xhr.onload = function() {
        document.getElementById('result').textContent = 
          'Status: ' + xhr.status + '\n' +
          'Response: ' + xhr.responseText;
      };
      
      xhr.onerror = function() {
        document.getElementById('result').textContent = '请求失败';
      };
      
      xhr.send('username=admin&password=068162');
    }
  </script>
</body>
</html>