<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvasè½®å¸¦æ»šåŠ¨æ•ˆæœæ¼”ç¤º</title>
    <style>
        body {
            background: #0b1020;
            color: #fff;
            font-family: sans-serif;
            text-align: center;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .demo-section {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 2px solid #3af;
        }
        .demo-title {
            color: #3af;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .reels-demo {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        .reel-demo canvas {
            background: #000;
            border: 2px solid #3af;
            border-radius: 8px;
        }
        .btn {
            padding: 10px 25px;
            margin: 5px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #3af;
            color: #000;
            font-weight: bold;
        }
        .btn:disabled {
            background: #555;
            color: #aaa;
        }
        .status {
            margin: 15px 0;
            font-size: 18px;
            min-height: 25px;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .comparison-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
        }
        .comparison-item h4 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        .feature-list {
            text-align: left;
            margin: 10px 0;
        }
        .feature-list li {
            margin: 5px 0;
            padding-left: 10px;
        }
        .highlight {
            color: #3af;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ° Canvasè½®å¸¦æ»šåŠ¨æ•ˆæœæ¼”ç¤º</h1>
        
        <div class="demo-section">
            <div class="demo-title">åŸºäºfruit.htmlå®ç°çš„çœŸå®è½®å¸¦æ•ˆæœ</div>
            <div class="reels-demo" id="reels-demo">
                <div class="reel-demo">
                    <canvas width="120" height="240"></canvas>
                </div>
                <div class="reel-demo">
                    <canvas width="120" height="240"></canvas>
                </div>
                <div class="reel-demo">
                    <canvas width="120" height="240"></canvas>
                </div>
            </div>
            <div>
                <button class="btn" id="btnStart">å¼€å§‹æ¼”ç¤º</button>
                <button class="btn" id="btnStop" disabled>åœæ­¢æ¼”ç¤º</button>
            </div>
            <div class="status" id="status">ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"æŸ¥çœ‹è½®å¸¦æ»šåŠ¨æ•ˆæœ</div>
        </div>

        <div class="demo-section">
            <div class="demo-title">æŠ€æœ¯å®ç°å¯¹æ¯”</div>
            <div class="comparison">
                <div class="comparison-item">
                    <h4>åŸæ¥çš„CSSåŠ¨ç”»æ–¹å¼</h4>
                    <div class="feature-list">
                        <li>âŒ ä½¿ç”¨DOMå…ƒç´  + CSS transform</li>
                        <li>âŒ åŠ¨ç”»ä¸å¤Ÿæµç•…</li>
                        <li>âŒ æ— æ³•å®ç°çœŸæ­£çš„è½®å¸¦æ•ˆæœ</li>
                        <li>âŒ ç¬¦å·åˆ‡æ¢ç”Ÿç¡¬</li>
                        <li>âŒ æ€§èƒ½è¾ƒå·®</li>
                    </div>
                </div>
                <div class="comparison-item">
                    <h4>æ–°çš„Canvasè½®å¸¦æ–¹å¼</h4>
                    <div class="feature-list">
                        <li class="highlight">âœ… ä½¿ç”¨Canvas 2Dç»˜å›¾API</li>
                        <li class="highlight">âœ… 60fpsæµç•…åŠ¨ç”»</li>
                        <li class="highlight">âœ… çœŸæ­£çš„è¿ç»­ç¬¦å·å¸¦æ»šåŠ¨</li>
                        <li class="highlight">âœ… ç‰©ç†è¿åŠ¨æ¨¡æ‹Ÿ</li>
                        <li class="highlight">âœ… é«˜æ€§èƒ½æ¸²æŸ“</li>
                    </div>
                </div>
            </div>
        </div>

        <div class="demo-section">
            <div class="demo-title">åŠ²çˆ†ç‰¹æ•ˆæ¼”ç¤º</div>
            <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0;">
                <button class="btn" onclick="showMiniJackpotDemo()">å°å¥–ç‰¹æ•ˆ</button>
                <button class="btn" onclick="showMajorJackpotDemo()">å¤§å¥–ç‰¹æ•ˆ</button>
                <button class="btn" onclick="showSuperJackpotDemo()">è¶…çº§å¤§å¥–</button>
                <button class="btn" onclick="showFreeSpinsDemo()">å…è´¹æ—‹è½¬</button>
            </div>
            <div class="status" id="effect-status">ç‚¹å‡»æŒ‰é’®ä½“éªŒåŠ²çˆ†ç‰¹æ•ˆ</div>
        </div>

        <div style="margin-top: 30px;">
            <a href="/slot-game.html" class="btn" style="background: linear-gradient(45deg, #FFD700, #FFA500); color: #333; text-decoration: none;">
                ğŸ° ä½“éªŒå®Œæ•´æ¸¸æˆ
            </a>
        </div>
    </div>

    <script>
        // è§’å­æœºç¬¦å·
        const DEMO_SYMBOLS = ["ğŸ’","ğŸ‹","ğŸ‡","â­ï¸","ğŸ‰","ğŸ””","7ï¸âƒ£","ğŸ€","ğŸ"];
        const SYMBOL_SIZE = 60;
        const REPEAT = 4;

        // è½®å¸¦ç±»ï¼ˆåŸºäºfruit.htmlï¼‰
        class DemoReel {
            constructor(canvas, symbols) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d');
                this.w = canvas.width;
                this.h = canvas.height;
                this.symbols = symbols;
                this.vel = 0;
                this.targetVel = 0;
                this.state = 'idle';
                this.targetIndex = 0;
                this.sprite = this.buildStrip();
                this.off = 0;
            }

            buildStrip() {
                const itemH = SYMBOL_SIZE;
                const totalItems = this.symbols.length * REPEAT;
                const strip = document.createElement('canvas');
                strip.width = this.w;
                strip.height = totalItems * itemH;
                const c = strip.getContext('2d');
                
                c.textAlign = 'center';
                c.textBaseline = 'middle';
                c.font = `bold ${Math.floor(itemH * 0.6)}px system-ui`;
                
                for (let r = 0; r < REPEAT; r++) {
                    for (let i = 0; i < this.symbols.length; i++) {
                        const y = (r * this.symbols.length + i) * itemH + itemH / 2;
                        
                        // èƒŒæ™¯
                        c.fillStyle = '#333';
                        c.fillRect(2, (r * this.symbols.length + i) * itemH + 2, this.w - 4, itemH - 4);
                        
                        // è¾¹æ¡†
                        c.strokeStyle = '#3af';
                        c.lineWidth = 1;
                        c.strokeRect(2, (r * this.symbols.length + i) * itemH + 2, this.w - 4, itemH - 4);
                        
                        // ç¬¦å·
                        c.fillStyle = '#fff';
                        c.fillText(this.symbols[i], strip.width / 2, y);
                    }
                }
                
                return strip;
            }

            start(speed) {
                this.state = 'spinning';
                this.vel = speed;
                this.targetVel = speed;
            }

            requestStop(targetIndex) {
                if (this.state === 'spinning') {
                    this.state = 'stopping';
                    this.targetIndex = targetIndex % this.symbols.length;
                }
            }

            forceStopNow() {
                this.state = 'stopping';
                this.targetIndex = Math.floor(Math.random() * this.symbols.length);
                this.targetVel = 0;
            }

            update(dt) {
                const itemH = SYMBOL_SIZE;
                const len = this.symbols.length;
                const cycle = len * itemH;

                if (this.state === 'stopping') {
                    const offMod = ((this.off % cycle) + cycle) % cycle;
                    const curIndex = Math.round(offMod / itemH) % len;
                    const remainCells = ((len + curIndex - this.targetIndex) % len) || len;
                    const remainPx = remainCells * itemH - (offMod % itemH);

                    if (remainPx < 10) {
                        const lockTo = Math.round(this.off / itemH) * itemH;
                        this.off = lockTo;
                        this.vel = 0;
                        this.targetVel = 0;
                        this.state = 'locked';
                    } else {
                        this.vel = 300;
                    }
                }

                this.off += this.vel * dt;
                this.draw();
            }

            draw() {
                const ctx = this.ctx;
                const strip = this.sprite;
                const totalH = strip.height;
                let y = this.off % totalH;
                if (y < 0) y += totalH;

                ctx.clearRect(0, 0, this.w, this.h);
                
                const s1 = Math.min(this.h, totalH - y);
                ctx.drawImage(strip, 0, y, this.w, s1, 0, 0, this.w, s1);
                if (this.h > s1) {
                    const s2 = this.h - s1;
                    ctx.drawImage(strip, 0, 0, this.w, s2, 0, s1, this.w, s2);
                }

                ctx.fillStyle = 'rgba(58,175,255,.3)';
                ctx.fillRect(0, this.h / 2 - 1, this.w, 2);
            }
        }

        // æ¼”ç¤ºæ§åˆ¶
        const demoReels = [...document.querySelectorAll('.reel-demo canvas')].map(c => new DemoReel(c, DEMO_SYMBOLS));
        let demoRaf = 0, demoLast = 0, demoSpinning = false;
        const demoStatus = document.getElementById('status');
        const btnStart = document.getElementById('btnStart');
        const btnStop = document.getElementById('btnStop');

        function demoLoop(ts) {
            if (!demoLast) demoLast = ts;
            const dt = (ts - demoLast) / 1000;
            demoLast = ts;
            
            demoReels.forEach(r => r.update(dt));

            const locked = demoReels.filter(r => r.state === 'locked').length;
            if (demoSpinning && locked === demoReels.length) {
                demoSpinning = false;
                cancelAnimationFrame(demoRaf);
                demoRaf = 0;
                demoLast = 0;
                btnStart.disabled = false;
                btnStop.disabled = true;
                demoStatus.innerText = 'æ¼”ç¤ºå®Œæˆï¼ç‚¹å‡»"å¼€å§‹æ¼”ç¤º"é‡æ–°ä½“éªŒ';
                return;
            }

            if (demoSpinning) demoRaf = requestAnimationFrame(demoLoop);
        }

        function startDemo() {
            if (demoSpinning) return;
            demoStatus.innerText = 'è½®å¸¦æ»šåŠ¨ä¸­...';
            demoSpinning = true;
            demoLast = 0;
            if (demoRaf) cancelAnimationFrame(demoRaf);

            demoReels.forEach(r => r.start(600));

            const runMs = 3000;
            const gaps = [0, 400, 800];

            setTimeout(() => demoReels[0].requestStop(Math.floor(Math.random() * DEMO_SYMBOLS.length)), runMs + gaps[0]);
            setTimeout(() => demoReels[1].requestStop(Math.floor(Math.random() * DEMO_SYMBOLS.length)), runMs + gaps[1]);
            setTimeout(() => demoReels[2].requestStop(Math.floor(Math.random() * DEMO_SYMBOLS.length)), runMs + gaps[2]);

            btnStart.disabled = true;
            btnStop.disabled = false;
            demoRaf = requestAnimationFrame(demoLoop);
        }

        function forceStop() {
            if (!demoSpinning) return;
            demoReels.forEach(r => r.forceStopNow());
            demoStatus.innerText = 'å¼ºåˆ¶åœæ­¢ä¸­...';
        }

        btnStart.addEventListener('click', startDemo);
        btnStop.addEventListener('click', forceStop);

        // åˆå§‹ç»˜åˆ¶
        demoReels.forEach(r => r.draw());
        
        // ç‰¹æ•ˆæ¼”ç¤ºå‡½æ•°
        function showMiniJackpotDemo() {
            showNormalJackpotEffect('å¤šå¯¿å°å¥–', 500, 'mini');
        }
        
        function showMajorJackpotDemo() {
            showNormalJackpotEffect('å¤šè´¢å¤§å¥–', 5000, 'major');
        }
        
        function showSuperJackpotDemo() {
            showSuperJackpotEffect(50000);
        }
        
        function showFreeSpinsDemo() {
            showFreeSpinsWin({free_spins: 15, count: 3});
        }
        
        // ç‰¹æ•ˆå‡½æ•°ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function showNormalJackpotEffect(levelName, amount, level) {
            const colors = {
                'mini': '#32CD32',
                'minor': '#00BFFF', 
                'major': '#FF6347',
                'grand': '#9370DB'
            };
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%; left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, ${colors[level]}, #FFD700);
                padding: 30px;
                border-radius: 15px;
                border: 3px solid #FFD700;
                z-index: 10000;
                text-align: center;
                box-shadow: 0 0 30px ${colors[level]};
                animation: jackpotBounce 1s ease-out;
            `;
            
            modal.innerHTML = `
                <div style="color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">
                    <div style="font-size: 1.8rem; margin-bottom: 10px;">ğŸŠ ${levelName} ğŸŠ</div>
                    <div style="font-size: 2rem; font-weight: bold; margin-bottom: 10px;">ï¿¥${amount}</div>
                    <div style="font-size: 1.2rem;">ğŸ‰ æ­å–œä¸­å¥–ï¼ ğŸ‰</div>
                </div>
            `;
            
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
            
            const closeModal = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(modal);
            };
            
            overlay.addEventListener('click', closeModal);
            modal.addEventListener('click', closeModal);
            
            setTimeout(closeModal, 1500);
        }
        
        function showSuperJackpotEffect(amount) {
            // ç®€åŒ–ç‰ˆè¶…çº§å¤§å¥–ç‰¹æ•ˆ
            const superModal = document.createElement('div');
            superModal.style.cssText = `
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.9);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
            `;
            
            superModal.innerHTML = `
                <div style="
                    text-align: center;
                    color: #FFD700;
                    animation: jackpotBounce 1s infinite;
                ">
                    <div style="font-size: 3rem; margin-bottom: 15px;">ğŸ†ğŸ†ğŸ†</div>
                    <div style="font-size: 2rem; font-weight: bold; margin-bottom: 15px;">ä¼ è¯´ä¸­çš„è¶…çº§å¤§å¥–ï¼</div>
                    <div style="font-size: 3rem; font-weight: bold; margin-bottom: 15px; color: #FF4500;">ï¿¥${amount}</div>
                    <div style="font-size: 1.5rem;">ğŸ‰ æ‚¨æˆä¸ºäº†ä»Šæ—¥çš„å¹¸è¿ç‹ï¼ ğŸ‰</div>
                </div>
            `;
            
            document.body.appendChild(superModal);
            
            setTimeout(() => {
                document.body.removeChild(superModal);
            }, 2000);
        }
        
        function showFreeSpinsWin(scatterData) {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 50%; left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(45deg, #9B59B6, #8E44AD);
                padding: 30px;
                border-radius: 15px;
                border: 3px solid #FFD700;
                z-index: 10000;
                text-align: center;
                box-shadow: 0 0 30px #9B59B6;
                animation: jackpotBounce 1s ease-out;
            `;
            
            modal.innerHTML = `
                <div style="color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.8);">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ† å…è´¹æ—‹è½¬ï¼ ğŸ†</div>
                    <div style="font-size: 2.5rem; font-weight: bold; margin-bottom: 10px;">${scatterData.free_spins} æ¬¡</div>
                    <div style="font-size: 1.2rem; margin-bottom: 5px;">ğŸ¯ ${scatterData.count}ä¸ª Scatter ç¬¦å·è§¦å‘ï¼</div>
                    <div style="font-size: 1rem;">ğŸ‰ æ— é™æƒŠå–œç­‰ç€æ‚¨ï¼ ğŸ‰</div>
                </div>
            `;
            
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 9999;
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
            
            const closeModal = () => {
                document.body.removeChild(overlay);
                document.body.removeChild(modal);
            };
            
            overlay.addEventListener('click', closeModal);
            modal.addEventListener('click', closeModal);
            
            setTimeout(closeModal, 2000);
        }
        
        // æ·»åŠ åŠ¨ç”»æ ·å¼
        if (!document.querySelector('#demo-animations')) {
            const style = document.createElement('style');
            style.id = 'demo-animations';
            style.textContent = `
                @keyframes jackpotBounce {
                    0%, 20%, 50%, 80%, 100% { transform: translate(-50%, -50%) translateY(0) scale(1); }
                    40% { transform: translate(-50%, -50%) translateY(-20px) scale(1.1); }
                    60% { transform: translate(-50%, -50%) translateY(-10px) scale(1.05); }
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>