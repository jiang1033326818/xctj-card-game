<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>美式轮盘游戏</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1e3c72;
            color: white;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .nav-btn {
            padding: 10px 20px;
            border: none;
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }
        .nav-btn.active { background: #4CAF50; }
        .interface { display: none; }
        .interface.active { display: block; }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 18px;
        }
        .roulette-area {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .number-strip-container {
            position: relative;
            height: 80px;
            background: #2d5a27;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
            width: 100%;
        }
        .pointer {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 30px;
            color: #FFD700;
            z-index: 10;
            width: 2px;
            height: 2px;
            background: #FFD700;
        }
        .pointer::before {
            content: '▼';
            position: absolute;
            top: -15px;
            left: -15px;
            font-size: 30px;
        }
        .number-strip {
            display: flex;
            height: 100%;
            transition: none;
            width: max-content;
        }
        .number-strip.spinning {
            transition: transform 3s ease-out;
        }
        .number-cell {
            width: 80px;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            border: 1px solid white;
            color: white;
            box-sizing: border-box;
        }
        .red { background: #dc3545; }
        .black { background: #343a40; }
        .green { background: #28a745; }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        .btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .btn-primary { background: #4CAF50; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        
        .betting-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .chips {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .chip {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid white;
            font-weight: bold;
        }
        .chip.selected { box-shadow: 0 0 10px #FFD700; }
        .chip[data-value="1"] { background: white; color: black; }
        .chip[data-value="5"] { background: #dc3545; color: white; }
        .chip[data-value="10"] { background: #007bff; color: white; }
        .chip[data-value="25"] { background: #28a745; color: white; }
        .chip[data-value="100"] { background: #6f42c1; color: white; }
        
        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
            margin-bottom: 20px;
        }
        .bet-cell {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255,255,255,0.1);
            border: 1px solid white;
            cursor: pointer;
            font-weight: bold;
            position: relative;
        }
        .bet-cell:hover { background: rgba(255,255,255,0.3); }
        .bet-amount {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #FFD700;
            color: black;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }
        
        .result {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            margin: 20px 0;
        }
        .result.hidden { display: none; }
        .result-number {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .history {
            margin-top: 20px;
        }
        .history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }
        .history-item {
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
        }
        
        .stats-container {
            background: rgba(0,0,0,0.3);
            padding: 30px;
            border-radius: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="nav">
            <button id="playerView" class="nav-btn active">玩家界面</button>
            <button id="houseView" class="nav-btn">庄家统计</button>
        </nav>
        
        <div id="playerInterface" class="interface active">
            <h1>美式轮盘游戏</h1>
            
            <div class="game-info">
                <div>余额: $<span id="balance">1000</span></div>
                <div>状态: <span id="status">等待下注</span></div>
            </div>
            
            <div class="roulette-area">
                <div class="number-strip-container">
                    <div class="pointer"></div>
                    <div id="numberStrip" class="number-strip"></div>
                </div>
                
                <div class="controls">
                    <button id="spinBtn" class="btn btn-primary">开始游戏</button>
                    <button id="clearBtn" class="btn btn-secondary">清除押注</button>
                </div>
            </div>
            
            <div id="result" class="result hidden">
                <div class="result-number" id="resultNumber"></div>
                <div id="resultText"></div>
            </div>
            
            <div class="betting-area">
                <div>
                    <h3>选择筹码</h3>
                    <div class="chips">
                        <div class="chip selected" data-value="1">$1</div>
                        <div class="chip" data-value="5">$5</div>
                        <div class="chip" data-value="10">$10</div>
                        <div class="chip" data-value="25">$25</div>
                        <div class="chip" data-value="100">$100</div>
                    </div>
                    
                    <h3>当前押注</h3>
                    <div id="betsList"></div>
                    <div>总押注: $<span id="totalBet">0</span></div>
                </div>
                
                <div>
                    <h3>投注区域</h3>
                    <div class="numbers-grid" id="numbersGrid"></div>
                    
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 10px;">
                        <div class="bet-cell red" data-bet="red">红色</div>
                        <div class="bet-cell black" data-bet="black">黑色</div>
                        <div class="bet-cell green" data-bet="green">绿色</div>
                        <div class="bet-cell" data-bet="odd">奇数</div>
                        <div class="bet-cell" data-bet="even">偶数</div>
                        <div class="bet-cell" data-bet="1-18">1-18</div>
                        <div class="bet-cell" data-bet="19-36">19-36</div>
                        <div class="bet-cell" data-bet="1st12">1st 12</div>
                        <div class="bet-cell" data-bet="2nd12">2nd 12</div>
                        <div class="bet-cell" data-bet="3rd12">3rd 12</div>
                    </div>
                </div>
            </div>
            
            <div class="history">
                <h3>历史记录</h3>
                <div id="historyList" class="history-list"></div>
            </div>
        </div>
        
        <div id="houseInterface" class="interface">
            <div class="stats-container">
                <h2>庄家统计</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>总收益</h3>
                        <div class="stat-value" id="houseProfit">$0</div>
                    </div>
                    <div class="stat-card">
                        <h3>游戏局数</h3>
                        <div class="stat-value" id="totalGames">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>庄家优势</h3>
                        <div class="stat-value" id="houseEdge">0%</div>
                    </div>
                </div>
                <button id="resetStats" class="btn btn-danger">重置统计</button>
            </div>
        </div>
    </div>

    <script>
        class FixedRoulette {
            constructor() {
                // 美式轮盘标准数字序列
                this.numbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26, '00'];
                this.colors = {
                    0: 'green', '00': 'green',
                    1: 'red', 2: 'black', 3: 'red', 4: 'black', 5: 'red', 6: 'black',
                    7: 'red', 8: 'black', 9: 'red', 10: 'black', 11: 'black', 12: 'red',
                    13: 'black', 14: 'red', 15: 'black', 16: 'red', 17: 'black', 18: 'red',
                    19: 'red', 20: 'black', 21: 'red', 22: 'black', 23: 'red', 24: 'black',
                    25: 'red', 26: 'black', 27: 'red', 28: 'black', 29: 'black', 30: 'red',
                    31: 'black', 32: 'red', 33: 'black', 34: 'red', 35: 'black', 36: 'red'
                };
                
                this.balance = 1000;
                this.selectedChip = 1;
                this.currentBets = {};
                this.isSpinning = false;
                this.stripPosition = 0;
                this.history = [];
                this.stats = {
                    totalGames: 0,
                    houseProfit: 0,
                    totalPlayerBets: 0
                };
                this.cellWidth = 80; // 每个格子的宽度
                
                this.init();
            }
            
            init() {
                this.createNumberStrip();
                this.createNumbersGrid();
                this.bindEvents();
                this.updateDisplay();
                this.loadStats();
            }
            
            createNumberStrip() {
                const strip = document.getElementById('numberStrip');
                strip.innerHTML = '';
                
                // 创建足够多的重复数字确保无缝滚动
                for (let i = 0; i < 8; i++) {
                    this.numbers.forEach(num => {
                        const cell = document.createElement('div');
                        cell.className = `number-cell ${this.colors[num]}`;
                        cell.textContent = num;
                        strip.appendChild(cell);
                    });
                }
                
                // 设置初始位置 - 让第一个数字0对准指针
                setTimeout(() => {
                    const containerWidth = document.querySelector('.number-strip-container').offsetWidth;
                    const pointerPosition = containerWidth / 2;
                    
                    // 计算让第一个数字0对准指针的位置
                    // 第一个0在索引0，位置是 0 * 80 + 40 = 40（格子中心）
                    // 要让它对准指针，需要移动 pointerPosition - 40
                    this.stripPosition = pointerPosition - (this.cellWidth / 2);
                    strip.style.transform = `translateX(${this.stripPosition}px)`;
                    
                    console.log(`初始化：容器宽度=${containerWidth}, 指针位置=${pointerPosition}, 数字带位置=${this.stripPosition}`);
                }, 100);
            }
            
            createNumbersGrid() {
                const grid = document.getElementById('numbersGrid');
                grid.innerHTML = '';
                
                // 添加0和00
                [0, '00'].forEach(num => {
                    const cell = document.createElement('div');
                    cell.className = `bet-cell ${this.colors[num]}`;
                    cell.textContent = num;
                    cell.dataset.bet = num;
                    grid.appendChild(cell);
                });
                
                // 添加1-36
                for (let i = 1; i <= 36; i++) {
                    const cell = document.createElement('div');
                    cell.className = `bet-cell ${this.colors[i]}`;
                    cell.textContent = i;
                    cell.dataset.bet = i;
                    grid.appendChild(cell);
                }
            }
            
            bindEvents() {
                // 界面切换
                document.getElementById('playerView').addEventListener('click', () => this.switchInterface('player'));
                document.getElementById('houseView').addEventListener('click', () => this.switchInterface('house'));
                
                // 筹码选择
                document.querySelectorAll('.chip').forEach(chip => {
                    chip.addEventListener('click', (e) => {
                        document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
                        e.target.classList.add('selected');
                        this.selectedChip = parseInt(e.target.dataset.value);
                    });
                });
                
                // 投注
                document.querySelectorAll('.bet-cell').forEach(cell => {
                    cell.addEventListener('click', (e) => {
                        this.placeBet(e.target.dataset.bet);
                    });
                });
                
                // 控制按钮
                document.getElementById('spinBtn').addEventListener('click', () => this.spin());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearBets());
                document.getElementById('resetStats').addEventListener('click', () => this.resetStats());
            }
            
            switchInterface(type) {
                document.querySelectorAll('.interface').forEach(i => i.classList.remove('active'));
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                
                if (type === 'player') {
                    document.getElementById('playerInterface').classList.add('active');
                    document.getElementById('playerView').classList.add('active');
                } else {
                    document.getElementById('houseInterface').classList.add('active');
                    document.getElementById('houseView').classList.add('active');
                    this.updateStatsDisplay();
                }
            }
            
            placeBet(betType) {
                if (this.isSpinning) return;
                if (this.balance < this.selectedChip) {
                    alert('余额不足！');
                    return;
                }
                
                this.balance -= this.selectedChip;
                this.currentBets[betType] = (this.currentBets[betType] || 0) + this.selectedChip;
                this.updateDisplay();
            }
            
            clearBets() {
                if (this.isSpinning) return;
                
                Object.values(this.currentBets).forEach(amount => {
                    this.balance += amount;
                });
                this.currentBets = {};
                this.updateDisplay();
            }
            
            spin() {
                if (this.isSpinning || Object.keys(this.currentBets).length === 0) {
                    if (Object.keys(this.currentBets).length === 0) {
                        alert('请先下注！');
                    }
                    return;
                }
                
                this.isSpinning = true;
                document.getElementById('status').textContent = '轮盘转动中...';
                document.getElementById('spinBtn').disabled = true;
                
                // 随机移动距离，不预设结果
                const minDistance = 2000; // 最小移动距离
                const maxDistance = 5000; // 最大移动距离
                const moveDistance = Math.random() * (maxDistance - minDistance) + minDistance;
                
                // 随机方向（向左移动）
                this.stripPosition -= moveDistance;
                
                console.log(`开始旋转，移动距离: ${moveDistance}`);
                console.log(`新位置: ${this.stripPosition}`);
                
                const strip = document.getElementById('numberStrip');
                strip.classList.add('spinning');
                strip.style.transform = `translateX(${this.stripPosition}px)`;
                
                setTimeout(() => {
                    this.finishSpin();
                }, 3000);
            }
            
            finishSpin() {
                // 获取所有数字格子的DOM元素
                const strip = document.getElementById('numberStrip');
                const cells = strip.querySelectorAll('.number-cell');
                const containerWidth = document.querySelector('.number-strip-container').offsetWidth;
                const pointerPosition = containerWidth / 2;
                
                console.log(`=== 新的调试方法 ===`);
                console.log(`容器宽度: ${containerWidth}, 指针位置: ${pointerPosition}`);
                
                let closestDistance = Infinity;
                let closestResult = null;
                let closestCellInfo = null;
                
                // 遍历所有可见的数字格子
                cells.forEach((cell, index) => {
                    const rect = cell.getBoundingClientRect();
                    const containerRect = document.querySelector('.number-strip-container').getBoundingClientRect();
                    
                    // 计算格子相对于容器的位置
                    const cellLeft = rect.left - containerRect.left;
                    const cellRight = rect.right - containerRect.left;
                    const cellCenter = (cellLeft + cellRight) / 2;
                    const distance = Math.abs(pointerPosition - cellCenter);
                    
                    const number = cell.textContent;
                    
                    console.log(`格子${index}: 数字${number}, 左边${cellLeft.toFixed(1)}, 右边${cellRight.toFixed(1)}, 中心${cellCenter.toFixed(1)}, 距离指针${distance.toFixed(1)}px`);
                    
                    // 只考虑在容器内可见的格子
                    if (cellLeft < containerWidth && cellRight > 0) {
                        if (distance < closestDistance) {
                            closestDistance = distance;
                            closestResult = number;
                            closestCellInfo = {
                                index,
                                left: cellLeft,
                                right: cellRight,
                                center: cellCenter
                            };
                        }
                    }
                });
                
                const result = closestResult;
                console.log(`最终结果: ${result} (距离指针${closestDistance.toFixed(1)}px)`);
                console.log(`获胜格子信息:`, closestCellInfo);
                
                // 计算奖金
                let winnings = 0;
                const totalBetAmount = Object.values(this.currentBets).reduce((sum, amount) => sum + amount, 0);
                
                Object.entries(this.currentBets).forEach(([betType, amount]) => {
                    const payout = this.calculatePayout(betType, result);
                    if (payout > 0) {
                        winnings += amount * (payout + 1);
                    }
                });
                
                this.balance += winnings;
                
                // 更新统计
                this.stats.totalGames++;
                this.stats.totalPlayerBets += totalBetAmount;
                this.stats.houseProfit += totalBetAmount - winnings;
                this.saveStats();
                
                // 添加到历史
                this.history.unshift(result);
                if (this.history.length > 20) {
                    this.history.pop();
                }
                
                // 显示结果
                this.showResult(result, winnings);
                
                // 重置
                this.currentBets = {};
                this.isSpinning = false;
                document.getElementById('status').textContent = '等待下注';
                document.getElementById('spinBtn').disabled = false;
                document.getElementById('numberStrip').classList.remove('spinning');
                
                setTimeout(() => {
                    document.getElementById('result').classList.add('hidden');
                    this.updateDisplay();
                }, 3000);
            }
            
            calculatePayout(betType, result) {
                if (betType == result) return 35;
                if (betType === 'red' && this.colors[result] === 'red') return 1;
                if (betType === 'black' && this.colors[result] === 'black') return 1;
                if (betType === 'green' && this.colors[result] === 'green') return 17;
                if (betType === 'odd' && result % 2 === 1 && result !== 0 && result !== '00') return 1;
                if (betType === 'even' && result % 2 === 0 && result !== 0 && result !== '00') return 1;
                if (betType === '1-18' && result >= 1 && result <= 18) return 1;
                if (betType === '19-36' && result >= 19 && result <= 36) return 1;
                if (betType === '1st12' && result >= 1 && result <= 12) return 2;
                if (betType === '2nd12' && result >= 13 && result <= 24) return 2;
                if (betType === '3rd12' && result >= 25 && result <= 36) return 2;
                return 0;
            }
            
            showResult(result, winnings) {
                const resultDiv = document.getElementById('result');
                const resultNumber = document.getElementById('resultNumber');
                const resultText = document.getElementById('resultText');
                
                resultNumber.textContent = result;
                resultNumber.className = `result-number ${this.colors[result]}`;
                
                if (winnings > 0) {
                    resultText.textContent = `恭喜！您赢得了 $${winnings}`;
                } else {
                    resultText.textContent = '很遗憾，您没有中奖';
                }
                
                resultDiv.classList.remove('hidden');
            }
            
            updateDisplay() {
                document.getElementById('balance').textContent = this.balance;
                
                // 更新押注显示
                const betsList = document.getElementById('betsList');
                const totalBet = document.getElementById('totalBet');
                
                betsList.innerHTML = '';
                let total = 0;
                
                Object.entries(this.currentBets).forEach(([betType, amount]) => {
                    const div = document.createElement('div');
                    div.textContent = `${betType}: $${amount}`;
                    betsList.appendChild(div);
                    total += amount;
                });
                
                totalBet.textContent = total;
                
                // 清除旧的押注显示
                document.querySelectorAll('.bet-amount').forEach(el => el.remove());
                
                // 显示新的押注
                Object.entries(this.currentBets).forEach(([betType, amount]) => {
                    const cell = document.querySelector(`[data-bet="${betType}"]`);
                    if (cell) {
                        const amountEl = document.createElement('div');
                        amountEl.className = 'bet-amount';
                        amountEl.textContent = amount;
                        cell.appendChild(amountEl);
                    }
                });
                
                // 更新历史记录
                const historyList = document.getElementById('historyList');
                historyList.innerHTML = '';
                this.history.forEach(num => {
                    const item = document.createElement('div');
                    item.className = `history-item ${this.colors[num]}`;
                    item.textContent = num;
                    historyList.appendChild(item);
                });
            }
            
            updateStatsDisplay() {
                document.getElementById('houseProfit').textContent = `$${this.stats.houseProfit}`;
                document.getElementById('totalGames').textContent = this.stats.totalGames;
                const houseEdge = this.stats.totalPlayerBets > 0 ? 
                    ((this.stats.houseProfit / this.stats.totalPlayerBets) * 100).toFixed(2) : 0;
                document.getElementById('houseEdge').textContent = `${houseEdge}%`;
            }
            
            saveStats() {
                localStorage.setItem('rouletteStats', JSON.stringify(this.stats));
            }
            
            loadStats() {
                const saved = localStorage.getItem('rouletteStats');
                if (saved) {
                    this.stats = JSON.parse(saved);
                }
            }
            
            resetStats() {
                if (confirm('确定要重置所有统计数据吗？')) {
                    this.stats = {
                        totalGames: 0,
                        houseProfit: 0,
                        totalPlayerBets: 0
                    };
                    this.saveStats();
                    this.updateStatsDisplay();
                }
            }
        }
        
        // 启动游戏
        document.addEventListener('DOMContentLoaded', () => {
            new FixedRoulette();
        });
    </script>
</body>
</html>